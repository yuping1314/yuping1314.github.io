


<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title> [ 小田技术博客 ]</title>
	
	
	<!-- stylesheets list from _config.yml -->
	
	<link rel="stylesheet" href="/css/PreciousJoy.css">
	
	<link rel="stylesheet" href="/css/top-bar.css">
	
	<link rel="stylesheet" href="/css/menu-outer.css">
	
	<link rel="stylesheet" href="/css/content-outer.css">
	
	<link rel="stylesheet" href="/css/bottom-outer.css">
	
	<link rel="stylesheet" href="/css/atom-one-dark.css">
	
	<link rel="stylesheet" href="/css/recent-posts-item.css">
	
	<link rel="stylesheet" href="/css/article-sidebar-toc.css">
	
	<link rel="stylesheet" href="/css/jquery.fancybox.min.css">
	
	<link rel="stylesheet" href="/css/search.css">
	
	<link rel="stylesheet" href="/css/toc.css">
	
	<link rel="stylesheet" href="/css/sidebar.css">
	
	<link rel="stylesheet" href="/css/archive.css">
	
	<link rel="stylesheet" href="/css/Z-last-cover-others.css">
	
	
	
<meta name="generator" content="Hexo 5.4.0"></head>




<body id="wrapper">

	<div id="">
		
		<div id="top-bar">
			
			<div id="avatar-box">
				<img 
				class="avatar"
				src="/images/your_picture_name.png" 
				alt="avatar">
			</div>

			<div id="top-bar-text">
				<div id="top-bar-title">
					fireworks99
				</div>
				<div id="top-bar-slogan">
					keep hungry keep foolish
				</div>
			</div>

		</div>

		<div id="menu-outer">
			<div id="menu-inner">
				
				
				<div class="menu-item">
					<a href="/">Home</a>
				</div>
				
				<div class="menu-item">
					<a href="/about">About</a>
				</div>
				
				<div class="menu-item">
					<a href="/archives">Archives</a>
				</div>
				

				<div class="menu-item menu-item-search">
					
  <span class="local-search local-search-google local-search-plugin">
      <input type="search" placeholder="站内搜索" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>
	
				</div>

			</div>
		</div>

		<div id="content-outer">
			<div id="content-inner">

				

<div id="recent-posts-box">

  
  <div id="recent-posts">
    <!-- <h1>Recent Posts</h1> -->
    
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC30%E8%AF%BE%EF%BC%9A%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.342Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第30课：正则表达式的应用正则表达式相关知识在编写处理字符串的程时，经常会遇到在一段文本中查找符合某些规则的字符串的需求，正则表达式就是用于描述这些规则的工具，换句话说，我们可以使用正则表达式来定义字符串的匹配模式，即如何检查一个字符串是否有跟某种模式匹配的部分或者从一个字符串中将与模式匹配的部分提取出来或者替换掉。
举一个简单的例子，如果你在Windows操作系统中使用过文件查找并且在指定文件名时使用过通配符（*和?），那么正则表达式也是与之类似的用 来进行文本匹配的工具，只不过比起通配符正则表达式更强大，它能更精确地描述你的需求，当然你付出的代价是书写一个正则表达式比使用通配符要复杂得多，因为任何给你带来好处的东西都需要你付出对应的代价。
再举一个例子，我们从某个地方（可能是一个文本文件，也可能是网络上的一则新闻）获得了一个字符串，希望在字符串中找出手机号和座机号。当然我们可以设定手机号是11位的数字（注意并不是随机的11位数字，因为你没有见过“25012345678”这样的手机号），而座机号则是类似于“区号-号码”这样的模式，如果不使用正则表达式要完成这个任务就会比较麻烦。最初计 -->
        <!-- </div> -->

        
        <h2 id="第30课：正则表达式的应用"><a href="#第30课：正则表达式的应用" class="headerlink" title="第30课：正则表达式的应用"></a>第30课：正则表达式的应用</h2><h3 id="正则表达式相关知识"><a href="#正则表达式相关知识" class="headerlink" title="正则表达式相关知识"></a>正则表达式相关知识</h3><p>在编写处理字符串的程时，经常会遇到在一段文本中查找符合某些规则的字符串的需求，正则表达式就是用于描述这些规则的工具，换句话说，我们可以使用正则表达式来定义字符串的匹配模式，即如何检查一个字符串是否有跟某种模式匹配的部分或者从一个字符串中将与模式匹配的部分提取出来或者替换掉。</p>
<p>举一个简单的例子，如果你在Windows操作系统中使用过文件查找并且在指定文件名时使用过通配符（<code>*</code>和<code>?</code>），那么正则表达式也是与之类似的用 来进行文本匹配的工具，只不过比起通配符正则表达式更强大，它能更精确地描述你的需求，当然你付出的代价是书写一个正则表达式比使用通配符要复杂得多，因为任何给你带来好处的东西都需要你付出对应的代价。</p>
<p>再举一个例子，我们从某个地方（可能是一个文本文件，也可能是网络上的一则新闻）获得了一个字符串，希望在字符串中找出手机号和座机号。当然我们可以设定手机号是11位的数字（注意并不是随机的11位数字，因为你没有见过“25012345678”这样的手机号），而座机号则是类似于“区号-号码”这样的模式，如果不使用正则表达式要完成这个任务就会比较麻烦。最初计算机是为了做数学运算而诞生的，处理的信息基本上都是数值，而今天我们在日常工作中处理的信息很多都是文本数据，我们希望计算机能够识别和处理符合某些模式的文本，正则表达式就显得非常重要了。今天几乎所有的编程语言都提供了对正则表达式操作的支持，Python通过标准库中的<code>re</code>模块来支持正则表达式操作。</p>
<p>关于正则表达式的相关知识，大家可以阅读一篇非常有名的博文叫<a target="_blank" rel="noopener" href="https://deerchao.net/tutorials/regex/regex.htm">《正则表达式30分钟入门教程》</a>，读完这篇文章后你就可以看懂下面的表格，这是我们对正则表达式中的一些基本符号进行的扼要总结。</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>解释</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>.</code></td>
<td>匹配任意字符</td>
<td><code>b.t</code></td>
<td>可以匹配bat / but / b#t / b1t等</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>匹配字母/数字/下划线</td>
<td><code>b\wt</code></td>
<td>可以匹配bat / b1t / b_t等<br>但不能匹配b#t</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>匹配空白字符（包括\r、\n、\t等）</td>
<td><code>love\syou</code></td>
<td>可以匹配love you</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>匹配数字</td>
<td><code>\d\d</code></td>
<td>可以匹配01 / 23 / 99等</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>匹配单词的边界</td>
<td><code>\bThe\b</code></td>
<td></td>
</tr>
<tr>
<td><code>^</code></td>
<td>匹配字符串的开始</td>
<td><code>^The</code></td>
<td>可以匹配The开头的字符串</td>
</tr>
<tr>
<td><code>$</code></td>
<td>匹配字符串的结束</td>
<td><code>.exe$</code></td>
<td>可以匹配.exe结尾的字符串</td>
</tr>
<tr>
<td><code>\W</code></td>
<td>匹配非字母/数字/下划线</td>
<td><code>b\Wt</code></td>
<td>可以匹配b#t / b@t等<br>但不能匹配but / b1t / b_t等</td>
</tr>
<tr>
<td><code>\S</code></td>
<td>匹配非空白字符</td>
<td><code>love\Syou</code></td>
<td>可以匹配love#you等<br>但不能匹配love you</td>
</tr>
<tr>
<td><code>\D</code></td>
<td>匹配非数字</td>
<td><code>\d\D</code></td>
<td>可以匹配9a / 3# / 0F等</td>
</tr>
<tr>
<td><code>\B</code></td>
<td>匹配非单词边界</td>
<td><code>\Bio\B</code></td>
<td></td>
</tr>
<tr>
<td><code>[]</code></td>
<td>匹配来自字符集的任意单一字符</td>
<td><code>[aeiou]</code></td>
<td>可以匹配任一元音字母字符</td>
</tr>
<tr>
<td><code>[^]</code></td>
<td>匹配不在字符集中的任意单一字符</td>
<td><code>[^aeiou]</code></td>
<td>可以匹配任一非元音字母字符</td>
</tr>
<tr>
<td><code>*</code></td>
<td>匹配0次或多次</td>
<td><code>\w*</code></td>
<td></td>
</tr>
<tr>
<td><code>+</code></td>
<td>匹配1次或多次</td>
<td><code>\w+</code></td>
<td></td>
</tr>
<tr>
<td><code>?</code></td>
<td>匹配0次或1次</td>
<td><code>\w?</code></td>
<td></td>
</tr>
<tr>
<td><code>&#123;N&#125;</code></td>
<td>匹配N次</td>
<td><code>\w&#123;3&#125;</code></td>
<td></td>
</tr>
<tr>
<td><code>&#123;M,&#125;</code></td>
<td>匹配至少M次</td>
<td><code>\w&#123;3,&#125;</code></td>
<td></td>
</tr>
<tr>
<td><code>&#123;M,N&#125;</code></td>
<td>匹配至少M次至多N次</td>
<td><code>\w&#123;3,6&#125;</code></td>
<td></td>
</tr>
<tr>
<td>`</td>
<td>`</td>
<td>分支</td>
<td>`foo</td>
</tr>
<tr>
<td><code>(?#)</code></td>
<td>注释</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>(exp)</code></td>
<td>匹配exp并捕获到自动命名的组中</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>(?&lt;name&gt;exp)</code></td>
<td>匹配exp并捕获到名为name的组中</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>(?:exp)</code></td>
<td>匹配exp但是不捕获匹配的文本</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>(?=exp)</code></td>
<td>匹配exp前面的位置</td>
<td><code>\b\w+(?=ing)</code></td>
<td>可以匹配I’m dancing中的danc</td>
</tr>
<tr>
<td><code>(?&lt;=exp)</code></td>
<td>匹配exp后面的位置</td>
<td><code>(?&lt;=\bdanc)\w+\b</code></td>
<td>可以匹配I love dancing and reading中的第一个ing</td>
</tr>
<tr>
<td><code>(?!exp)</code></td>
<td>匹配后面不是exp的位置</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>(?&lt;!exp)</code></td>
<td>匹配前面不是exp的位置</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>*?</code></td>
<td>重复任意次，但尽可能少重复</td>
<td><code>a.*b</code><br><code>a.*?b</code></td>
<td>将正则表达式应用于aabab，前者会匹配整个字符串aabab，后者会匹配aab和ab两个字符串</td>
</tr>
<tr>
<td><code>+?</code></td>
<td>重复1次或多次，但尽可能少重复</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>??</code></td>
<td>重复0次或1次，但尽可能少重复</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>&#123;M,N&#125;?</code></td>
<td>重复M到N次，但尽可能少重复</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>&#123;M,&#125;?</code></td>
<td>重复M次以上，但尽可能少重复</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>说明：</strong> 如果需要匹配的字符是正则表达式中的特殊字符，那么可以使用<code>\</code>进行转义处理，例如想匹配小数点可以写成<code>\.</code>就可以了，因为直接写<code>.</code>会匹配任意字符；同理，想匹配圆括号必须写成<code>\(</code>和<code>\)</code>，否则圆括号被视为正则表达式中的分组。</p>
</blockquote>
<h3 id="Python对正则表达式的支持"><a href="#Python对正则表达式的支持" class="headerlink" title="Python对正则表达式的支持"></a>Python对正则表达式的支持</h3><p>Python提供了<code>re</code>模块来支持正则表达式相关操作，下面是<code>re</code>模块中的核心函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>compile(pattern, flags=0)</code></td>
<td>编译正则表达式返回正则表达式对象</td>
</tr>
<tr>
<td><code>match(pattern, string, flags=0)</code></td>
<td>用正则表达式匹配字符串 成功返回匹配对象 否则返回<code>None</code></td>
</tr>
<tr>
<td><code>search(pattern, string, flags=0)</code></td>
<td>搜索字符串中第一次出现正则表达式的模式 成功返回匹配对象 否则返回<code>None</code></td>
</tr>
<tr>
<td><code>split(pattern, string, maxsplit=0, flags=0)</code></td>
<td>用正则表达式指定的模式分隔符拆分字符串 返回列表</td>
</tr>
<tr>
<td><code>sub(pattern, repl, string, count=0, flags=0)</code></td>
<td>用指定的字符串替换原字符串中与正则表达式匹配的模式 可以用<code>count</code>指定替换的次数</td>
</tr>
<tr>
<td><code>fullmatch(pattern, string, flags=0)</code></td>
<td><code>match</code>函数的完全匹配（从字符串开头到结尾）版本</td>
</tr>
<tr>
<td><code>findall(pattern, string, flags=0)</code></td>
<td>查找字符串所有与正则表达式匹配的模式 返回字符串的列表</td>
</tr>
<tr>
<td><code>finditer(pattern, string, flags=0)</code></td>
<td>查找字符串所有与正则表达式匹配的模式 返回一个迭代器</td>
</tr>
<tr>
<td><code>purge()</code></td>
<td>清除隐式编译的正则表达式的缓存</td>
</tr>
<tr>
<td><code>re.I</code> / <code>re.IGNORECASE</code></td>
<td>忽略大小写匹配标记</td>
</tr>
<tr>
<td><code>re.M</code> / <code>re.MULTILINE</code></td>
<td>多行匹配标记</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>说明：</strong> 上面提到的<code>re</code>模块中的这些函数，实际开发中也可以用正则表达式对象（<code>Pattern</code>对象）的方法替代对这些函数的使用，如果一个正则表达式需要重复的使用，那么先通过<code>compile</code>函数编译正则表达式并创建出正则表达式对象无疑是更为明智的选择。</p>
</blockquote>
<p>下面我们通过一系列的例子来告诉大家在Python中如何使用正则表达式。</p>
<h4 id="例子1：验证输入用户名和QQ号是否有效并给出对应的提示信息。"><a href="#例子1：验证输入用户名和QQ号是否有效并给出对应的提示信息。" class="headerlink" title="例子1：验证输入用户名和QQ号是否有效并给出对应的提示信息。"></a>例子1：验证输入用户名和QQ号是否有效并给出对应的提示信息。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">要求：用户名必须由字母、数字或下划线构成且长度在6~20个字符之间，QQ号是5~12的数字且首位不能为0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">username = <span class="built_in">input</span>(<span class="string">&#x27;请输入用户名: &#x27;</span>)</span><br><span class="line">qq = <span class="built_in">input</span>(<span class="string">&#x27;请输入QQ号: &#x27;</span>)</span><br><span class="line"><span class="comment"># match函数的第一个参数是正则表达式字符串或正则表达式对象</span></span><br><span class="line"><span class="comment"># match函数的第二个参数是要跟正则表达式做匹配的字符串对象</span></span><br><span class="line">m1 = re.match(<span class="string">r&#x27;^[0-9a-zA-Z_]&#123;6,20&#125;$&#x27;</span>, username)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> m1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;请输入有效的用户名.&#x27;</span>)</span><br><span class="line"><span class="comment"># fullmatch函数要求字符串和正则表达式完全匹配</span></span><br><span class="line"><span class="comment"># 所以正则表达式没有写起始符和结束符</span></span><br><span class="line">m2 = re.fullmatch(<span class="string">r&#x27;[1-9]\d&#123;4,11&#125;&#x27;</span>, qq)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> m2:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;请输入有效的QQ号.&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> m1 <span class="keyword">and</span> m2:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;你输入的信息是有效的!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示：</strong> 上面在书写正则表达式时使用了“原始字符串”的写法（在字符串前面加上了<code>r</code>），所谓“原始字符串”就是字符串中的每个字符都是它原始的意义，说得更直接一点就是字符串中没有所谓的转义字符啦。因为正则表达式中有很多元字符和需要进行转义的地方，如果不使用原始字符串就需要将反斜杠写作<code>\\</code>，例如表示数字的<code>\d</code>得书写成<code>\\d</code>，这样不仅写起来不方便，阅读的时候也会很吃力。</p>
</blockquote>
<h4 id="例子2：从一段文字中提取出国内手机号码。"><a href="#例子2：从一段文字中提取出国内手机号码。" class="headerlink" title="例子2：从一段文字中提取出国内手机号码。"></a>例子2：从一段文字中提取出国内手机号码。</h4><p>下面这张图是截止到2017年底，国内三家运营商推出的手机号段。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803203134.png">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建正则表达式对象，使用了前瞻和回顾来保证手机号前后不应该再出现数字</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?&lt;=\D)1[34578]\d&#123;9&#125;(?=\D)&#x27;</span>)</span><br><span class="line">sentence = <span class="string">&#x27;&#x27;&#x27;重要的事情说8130123456789遍，我的手机号是13512346789这个靓号，</span></span><br><span class="line"><span class="string">不是15600998765，也是110或119，王大锤的手机号才是15600998765。&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 方法一：查找所有匹配并保存到一个列表中</span></span><br><span class="line">tels_list = re.findall(pattern, sentence)</span><br><span class="line"><span class="keyword">for</span> tel <span class="keyword">in</span> tels_list:</span><br><span class="line">    <span class="built_in">print</span>(tel)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--------华丽的分隔线--------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：通过迭代器取出匹配对象并获得匹配的内容</span></span><br><span class="line"><span class="keyword">for</span> temp <span class="keyword">in</span> pattern.finditer(sentence):</span><br><span class="line">    <span class="built_in">print</span>(temp.group())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--------华丽的分隔线--------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三：通过search函数指定搜索位置找出所有匹配</span></span><br><span class="line">m = pattern.search(sentence)</span><br><span class="line"><span class="keyword">while</span> m:</span><br><span class="line">    <span class="built_in">print</span>(m.group())</span><br><span class="line">    m = pattern.search(sentence, m.end())</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明：</strong> 上面匹配国内手机号的正则表达式并不够好，因为像14开头的号码只有145或147，而上面的正则表达式并没有考虑这种情况，要匹配国内手机号，更好的正则表达式的写法是：<code>(?&lt;=\D)(1[38]\d&#123;9&#125;|14[57]\d&#123;8&#125;|15[0-35-9]\d&#123;8&#125;|17[678]\d&#123;8&#125;)(?=\D)</code>，国内好像已经有19和16开头的手机号了，但是这个暂时不在我们考虑之列。</p>
</blockquote>
<h4 id="例子3：替换字符串中的不良内容"><a href="#例子3：替换字符串中的不良内容" class="headerlink" title="例子3：替换字符串中的不良内容"></a>例子3：替换字符串中的不良内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">sentence = <span class="string">&#x27;Oh, shit! 你是傻逼吗? Fuck you.&#x27;</span></span><br><span class="line">purified = re.sub(<span class="string">&#x27;fuck|shit|[傻煞沙][比笔逼叉缺吊碉雕]&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;*&#x27;</span>, sentence, flags=re.IGNORECASE)</span><br><span class="line"><span class="built_in">print</span>(purified)  <span class="comment"># Oh, *! 你是*吗? * you.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明：</strong><code> re</code>模块的正则表达式相关函数中都有一个<code>flags</code>参数，它代表了正则表达式的匹配标记，可以通过该标记来指定匹配时是否忽略大小写、是否进行多行匹配、是否显示调试信息等。如果需要为flags参数指定多个值，可以使用<a target="_blank" rel="noopener" href="http://www.runoob.com/python/python-operators.html#ysf5">按位或运算符</a>进行叠加，如<code>flags=re.I | re.M</code>。</p>
</blockquote>
<h4 id="例子4：拆分长字符串"><a href="#例子4：拆分长字符串" class="headerlink" title="例子4：拆分长字符串"></a>例子4：拆分长字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">poem = <span class="string">&#x27;窗前明月光，疑是地上霜。举头望明月，低头思故乡。&#x27;</span></span><br><span class="line">sentences_list = re.split(<span class="string">r&#x27;[，。]&#x27;</span>, poem)</span><br><span class="line">sentences_list = [sentence <span class="keyword">for</span> sentence <span class="keyword">in</span> sentences_list <span class="keyword">if</span> sentence]</span><br><span class="line"><span class="keyword">for</span> sentence <span class="keyword">in</span> sentences_list:</span><br><span class="line">    <span class="built_in">print</span>(sentence)</span><br></pre></td></tr></table></figure>

<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>正则表达式在字符串的处理和匹配上真的非常强大，通过上面的例子相信大家已经感受到了正则表达式的魅力，当然写一个正则表达式对新手来说并不是那么容易，但是很多事情都是熟能生巧，大胆的去尝试就行了，有一个在线的<a target="_blank" rel="noopener" href="https://c.runoob.com/front-end/854">正则表达式测试工具</a>相信能够在一定程度上帮到大家。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第30课：正则表达式的应用/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC29%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E5%92%8C%E7%9F%AD%E4%BF%A1/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.335Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第29课：用Python发送邮件和短信在前面的课程中，我们已经教会大家如何用Python程序自动的生成Excel、Word、PDF文档，接下来我们还可以更进一步，就是通过邮件将生成好的文档发送给指定的收件人，然后用短信告知对方我们发出了邮件。这些事情利用Python程序也可以轻松愉快的解决。
发送电子邮件在即时通信软件如此发达的今天，电子邮件仍然是互联网上使用最为广泛的应用之一，公司向应聘者发出录用通知、网站向用户发送一个激活账号的链接、银行向客户推广它们的理财产品等几乎都是通过电子邮件来完成的，而这些任务应该都是由程序自动完成的。
我们可以用HTTP（超文本传输协议）来访问网站资源，HTTP是一个应用级协议，它建立在TCP（传输控制协议）之上，TCP为很多应用级协议提供了可靠的数据传输服务。如果要发送电子邮件，需要使用SMTP（简单邮件传输协议），它也是建立在TCP之上的应用级协议，规定了邮件的发送者如何跟邮件服务器进行通信的细节。Python通过名为smtplib的模块将这些操作简化成了SMTP_SSL对象，通过该对象的login和send_mail方法，就能够完成发送邮件的操作。 -->
        <!-- </div> -->

        
        <h2 id="第29课：用Python发送邮件和短信"><a href="#第29课：用Python发送邮件和短信" class="headerlink" title="第29课：用Python发送邮件和短信"></a>第29课：用Python发送邮件和短信</h2><p>在前面的课程中，我们已经教会大家如何用Python程序自动的生成Excel、Word、PDF文档，接下来我们还可以更进一步，就是通过邮件将生成好的文档发送给指定的收件人，然后用短信告知对方我们发出了邮件。这些事情利用Python程序也可以轻松愉快的解决。</p>
<h3 id="发送电子邮件"><a href="#发送电子邮件" class="headerlink" title="发送电子邮件"></a>发送电子邮件</h3><p>在即时通信软件如此发达的今天，电子邮件仍然是互联网上使用最为广泛的应用之一，公司向应聘者发出录用通知、网站向用户发送一个激活账号的链接、银行向客户推广它们的理财产品等几乎都是通过电子邮件来完成的，而这些任务应该都是由程序自动完成的。</p>
<p>我们可以用HTTP（超文本传输协议）来访问网站资源，HTTP是一个应用级协议，它建立在TCP（传输控制协议）之上，TCP为很多应用级协议提供了可靠的数据传输服务。如果要发送电子邮件，需要使用SMTP（简单邮件传输协议），它也是建立在TCP之上的应用级协议，规定了邮件的发送者如何跟邮件服务器进行通信的细节。Python通过名为<code>smtplib</code>的模块将这些操作简化成了<code>SMTP_SSL</code>对象，通过该对象的<code>login</code>和<code>send_mail</code>方法，就能够完成发送邮件的操作。</p>
<p>我们先尝试一下发送一封极为简单的邮件，该邮件不包含附件、图片以及其他超文本内容。发送邮件首先需要接入邮件服务器，我们可以自己架设邮件服务器，这件事情对新手并不友好，但是我们可以选择使用第三方提供的邮件服务。例如，我在&lt;<a target="_blank" rel="noopener" href="http://www.126.com&gt;已经注册了账号,登录成功之后,就可以在设置中开启smtp服务,这样就相当于获得了邮件服务器,具体的操作如下所示./">www.126.com&gt;已经注册了账号，登录成功之后，就可以在设置中开启SMTP服务，这样就相当于获得了邮件服务器，具体的操作如下所示。</a></p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820190307.png" alt="image-20210820190306861" width="95%">

<p><img src="https://gitee.com/jackfrued/mypic/raw/master/20210820190816.png" alt="image-20210820190816557"></p>
<p>用手机扫码上面的二维码可以通过发送短信的方式来获取授权码，短信发送成功后，点击“我已发送”就可以获得授权码。授权码需要妥善保管，因为一旦泄露就会被其他人冒用你的身份来发送邮件。接下来，我们就可以编写发送邮件的代码了，如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建邮件主体对象</span></span><br><span class="line">email = MIMEMultipart()</span><br><span class="line"><span class="comment"># 设置发件人、收件人和主题</span></span><br><span class="line">email[<span class="string">&#x27;From&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span></span><br><span class="line">email[<span class="string">&#x27;To&#x27;</span>] = <span class="string">&#x27;yyyyyy@qq.com;zzzzzz@1000phone.com&#x27;</span></span><br><span class="line">email[<span class="string">&#x27;Subject&#x27;</span>] = Header(<span class="string">&#x27;上半年工作情况汇报&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># 添加邮件正文内容</span></span><br><span class="line">content = <span class="string">&quot;&quot;&quot;据德国媒体报道，当地时间9日，德国火车司机工会成员进行了投票，</span></span><br><span class="line"><span class="string">定于当地时间10日起进行全国性罢工，货运交通方面的罢工已于当地时间10日19时开始。</span></span><br><span class="line"><span class="string">此后，从11日凌晨2时到13日凌晨2时，德国全国范围内的客运和铁路基础设施将进行48小时的罢工。&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建SMTP_SSL对象（连接邮件服务器）</span></span><br><span class="line">smtp_obj = smtplib.SMTP_SSL(<span class="string">&#x27;smtp.126.com&#x27;</span>, <span class="number">465</span>)</span><br><span class="line"><span class="comment"># 通过用户名和授权码进行登录</span></span><br><span class="line">smtp_obj.login(<span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span>, <span class="string">&#x27;邮件服务器的授权码&#x27;</span>)</span><br><span class="line"><span class="comment"># 发送邮件（发件人、收件人、邮件内容（字符串））</span></span><br><span class="line">smtp_obj.sendmail(</span><br><span class="line">    <span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span>,</span><br><span class="line">    [<span class="string">&#x27;yyyyyy@qq.com&#x27;</span>, <span class="string">&#x27;zzzzzz@1000phone.com&#x27;</span>],</span><br><span class="line">    email.as_string()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果要发送带有附件的邮件，只需要将附件的内容处理成BASE64编码，那么它就和普通的文本内容几乎没有什么区别。BASE64是一种基于64个可打印字符来表示二进制数据的表示方法，常用于某些需要表示、传输、存储二进制数据的场合，电子邮件就是其中之一。对这种编码方式不理解的同学，推荐阅读<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2008/06/base64.html">《Base64笔记》</a>一文。在之前的内容中，我们也提到过，Python标准库的<code>base64</code>模块提供了对BASE64编解码的支持。</p>
<p>下面的代码演示了如何发送带附件的邮件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建邮件主体对象</span></span><br><span class="line">email = MIMEMultipart()</span><br><span class="line"><span class="comment"># 设置发件人、收件人和主题</span></span><br><span class="line">email[<span class="string">&#x27;From&#x27;</span>] = <span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span></span><br><span class="line">email[<span class="string">&#x27;To&#x27;</span>] = <span class="string">&#x27;zzzzzzzz@1000phone.com&#x27;</span></span><br><span class="line">email[<span class="string">&#x27;Subject&#x27;</span>] = Header(<span class="string">&#x27;请查收离职证明文件&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># 添加邮件正文内容（带HTML标签排版的内容）</span></span><br><span class="line">content = <span class="string">&quot;&quot;&quot;&lt;p&gt;亲爱的前同事：&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;你需要的离职证明在附件中，请查收！&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;祝，好！&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;孙美丽 即日&lt;/p&gt;&quot;&quot;&quot;</span></span><br><span class="line">email.attach(MIMEText(content, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="comment"># 读取作为附件的文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;resources/王大锤离职证明.docx&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    attachment = MIMEText(file.read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 指定内容类型</span></span><br><span class="line">    attachment[<span class="string">&#x27;content-type&#x27;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">    <span class="comment"># 将中文文件名处理成百分号编码</span></span><br><span class="line">    filename = quote(<span class="string">&#x27;王大锤离职证明.docx&#x27;</span>)</span><br><span class="line">    <span class="comment"># 指定如何处置内容</span></span><br><span class="line">    attachment[<span class="string">&#x27;content-disposition&#x27;</span>] = <span class="string">f&#x27;attachment; filename=&quot;<span class="subst">&#123;filename&#125;</span>&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建SMTP_SSL对象（连接邮件服务器）</span></span><br><span class="line">smtp_obj = smtplib.SMTP_SSL(<span class="string">&#x27;smtp.126.com&#x27;</span>, <span class="number">465</span>)</span><br><span class="line"><span class="comment"># 通过用户名和授权码进行登录</span></span><br><span class="line">smtp_obj.login(<span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span>, <span class="string">&#x27;邮件服务器的授权码&#x27;</span>)</span><br><span class="line"><span class="comment"># 发送邮件（发件人、收件人、邮件内容（字符串））</span></span><br><span class="line">smtp_obj.sendmail(</span><br><span class="line">    <span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;zzzzzzzz@1000phone.com&#x27;</span>,</span><br><span class="line">    email.as_string()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>为了方便大家用Python实现邮件发送，我将上面的代码封装成了函数，使用的时候大家只需要调整邮件服务器域名、端口、用户名和授权码就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮件服务器域名（自行修改）</span></span><br><span class="line">EMAIL_HOST = <span class="string">&#x27;smtp.126.com&#x27;</span></span><br><span class="line"><span class="comment"># 邮件服务端口（通常是465）</span></span><br><span class="line">EMAIL_PORT = <span class="number">465</span></span><br><span class="line"><span class="comment"># 登录邮件服务器的账号（自行修改）</span></span><br><span class="line">EMAIL_USER = <span class="string">&#x27;xxxxxxxxx@126.com&#x27;</span></span><br><span class="line"><span class="comment"># 开通SMTP服务的授权码（自行修改）</span></span><br><span class="line">EMAIL_AUTH = <span class="string">&#x27;邮件服务器的授权码&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_email</span>(<span class="params">*, from_user, to_users, subject=<span class="string">&#x27;&#x27;</span>, content=<span class="string">&#x27;&#x27;</span>, filenames=[]</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;发送邮件</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param from_user: 发件人</span></span><br><span class="line"><span class="string">    :param to_users: 收件人，多个收件人用英文分号进行分隔</span></span><br><span class="line"><span class="string">    :param subject: 邮件的主题</span></span><br><span class="line"><span class="string">    :param content: 邮件正文内容</span></span><br><span class="line"><span class="string">    :param filenames: 附件要发送的文件路径</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    email = MIMEMultipart()</span><br><span class="line">    email[<span class="string">&#x27;From&#x27;</span>] = from_user</span><br><span class="line">    email[<span class="string">&#x27;To&#x27;</span>] = to_users</span><br><span class="line">    email[<span class="string">&#x27;Subject&#x27;</span>] = subject</span><br><span class="line"></span><br><span class="line">    message = MIMEText(content, <span class="string">&#x27;plain&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    email.attach(message)</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            pos = filename.rfind(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            display_filename = filename[pos + <span class="number">1</span>:] <span class="keyword">if</span> pos &gt;= <span class="number">0</span> <span class="keyword">else</span> filename</span><br><span class="line">            display_filename = quote(display_filename)</span><br><span class="line">            attachment = MIMEText(file.read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            attachment[<span class="string">&#x27;content-type&#x27;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">            attachment[<span class="string">&#x27;content-disposition&#x27;</span>] = <span class="string">f&#x27;attachment; filename=&quot;<span class="subst">&#123;display_filename&#125;</span>&quot;&#x27;</span></span><br><span class="line">            email.attach(attachment)</span><br><span class="line"></span><br><span class="line">    smtp = smtplib.SMTP_SSL(EMAIL_HOST, EMAIL_PORT)</span><br><span class="line">    smtp.login(EMAIL_USER, EMAIL_AUTH)</span><br><span class="line">    smtp.sendmail(from_user, to_users, email.as_string())</span><br></pre></td></tr></table></figure>

<h3 id="发送短信"><a href="#发送短信" class="headerlink" title="发送短信"></a>发送短信</h3><p>发送短信也是项目中常见的功能，网站的注册码、验证码、营销信息基本上都是通过短信来发送给用户的。发送短信需要三方平台的支持，下面我们以<a target="_blank" rel="noopener" href="https://luosimao.com/">螺丝帽平台</a>为例，为大家介绍如何用Python程序发送短信。注册账号和购买短信服务的细节我们不在这里进行赘述，大家可以咨询平台的客服。</p>
<p><img src="https://gitee.com/jackfrued/mypic/raw/master/20210820194421.png" alt="image-20210820194420911"></p>
<p>接下来，我们可以通过<code>requests</code>库向平台提供的短信网关发起一个HTTP请求，通过将接收短信的手机号和短信内容作为参数，就可以发送短信，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_message_by_luosimao</span>(<span class="params">tel, message</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;发送短信（调用螺丝帽短信网关）&quot;&quot;&quot;</span></span><br><span class="line">    resp = requests.post(</span><br><span class="line">        url=<span class="string">&#x27;http://sms-api.luosimao.com/v1/send.json&#x27;</span>,</span><br><span class="line">        auth=(<span class="string">&#x27;api&#x27;</span>, <span class="string">&#x27;key-注册成功后平台分配的KEY&#x27;</span>),</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;mobile&#x27;</span>: tel,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: message</span><br><span class="line">        &#125;,</span><br><span class="line">        timeout=<span class="number">10</span>,</span><br><span class="line">        verify=<span class="literal">False</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_mobile_code</span>(<span class="params">length=<span class="number">6</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成指定长度的手机验证码&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choices(<span class="string">&#x27;0123456789&#x27;</span>, k=length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    code = gen_mobile_code()</span><br><span class="line">    message = <span class="string">f&#x27;您的短信验证码是<span class="subst">&#123;code&#125;</span>，打死也不能告诉别人哟！【Python小课】&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(send_message_by_luosimao(<span class="string">&#x27;13500112233&#x27;</span>, message))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>上面请求螺丝帽的短信网关<code>http://sms-api.luosimao.com/v1/send.json</code>会返回JSON格式的数据，如果返回<code>&#123;&#39;error&#39;: 0, &#39;msg&#39;: &#39;OK&#39;&#125;</code>就说明短信已经发送成功了，如果<code>error</code>的值不是<code>0</code>，可以通过查看官方的<a target="_blank" rel="noopener" href="https://luosimao.com/docs/api/">开发文档</a>了解到底哪个环节出了问题。螺丝帽平台常见的错误类型如下图所示。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820195505.png" alt="image-20210820195505761" style="zoom:50%;">

<p>目前，大多数短信平台都会要求短信内容必须附上签名，下图是我在螺丝帽平台配置的短信签名“【Python小课】”。有些涉及到敏感内容的短信，还需要提前配置短信模板，有兴趣的读者可以自行研究。一般情况下，平台为了防范短信被盗用，还会要求设置“IP白名单”，不清楚如何配置的可以咨询平台客服。</p>
<p><img src="https://gitee.com/jackfrued/mypic/raw/master/20210820194653.png" alt="image-20210820194653785"></p>
<p>当然国内的短信平台很多，读者可以根据自己的需要进行选择（通常会考虑费用预算、短信达到率、使用的难易程度等指标），如果需要在商业项目中使用短信服务建议购买短信平台提供的套餐服务。</p>
<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>其实，发送邮件和发送短信一样，也可以通过调用三方服务来完成，在实际的商业项目中，建议自己架设邮件服务器或购买三方服务来发送邮件，这个才是比较靠谱的选择。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第29课：用Python发送邮件和短信/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC28%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.329Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第28课：用Python处理图像入门知识
颜色。如果你有使用颜料画画的经历，那么一定知道混合红、黄、蓝三种颜料可以得到其他的颜色，事实上这三种颜色就是美术中的三原色，它们是不能再分解的基本颜色。在计算机中，我们可以将红、绿、蓝三种色光以不同的比例叠加来组合成其他的颜色，因此这三种颜色就是色光三原色。在计算机系统中，我们通常会将一个颜色表示为一个RGB值或RGBA值（其中的A表示Alpha通道，它决定了透过这个图像的像素，也就是透明度）。



名称
RGB值
名称
RGB值



White（白）
(255, 255, 255)
Red（红）
(255, 0, 0)


Green（绿）
(0, 255, 0)
Blue（蓝）
(0, 0, 255)


Gray（灰）
(128, 128, 128)
Yellow（黄）
(255, 255, 0)


Black（黑）
(0, 0, 0)
Purple（紫）
(128, 0, 128)



像素。对于一个由数字序列表示的图像来说，最小的单位就是图像上单一颜色的小方格，这些小方块都有一个明确的位置和被分配的色彩数值，而这些一小方格的颜 -->
        <!-- </div> -->

        
        <h2 id="第28课：用Python处理图像"><a href="#第28课：用Python处理图像" class="headerlink" title="第28课：用Python处理图像"></a>第28课：用Python处理图像</h2><h3 id="入门知识"><a href="#入门知识" class="headerlink" title="入门知识"></a>入门知识</h3><ol>
<li><p>颜色。如果你有使用颜料画画的经历，那么一定知道混合红、黄、蓝三种颜料可以得到其他的颜色，事实上这三种颜色就是美术中的三原色，它们是不能再分解的基本颜色。在计算机中，我们可以将红、绿、蓝三种色光以不同的比例叠加来组合成其他的颜色，因此这三种颜色就是色光三原色。在计算机系统中，我们通常会将一个颜色表示为一个RGB值或RGBA值（其中的A表示Alpha通道，它决定了透过这个图像的像素，也就是透明度）。</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">RGB值</th>
<th align="center">名称</th>
<th align="center">RGB值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">White（白）</td>
<td align="center">(255, 255, 255)</td>
<td align="center">Red（红）</td>
<td align="center">(255, 0, 0)</td>
</tr>
<tr>
<td align="center">Green（绿）</td>
<td align="center">(0, 255, 0)</td>
<td align="center">Blue（蓝）</td>
<td align="center">(0, 0, 255)</td>
</tr>
<tr>
<td align="center">Gray（灰）</td>
<td align="center">(128, 128, 128)</td>
<td align="center">Yellow（黄）</td>
<td align="center">(255, 255, 0)</td>
</tr>
<tr>
<td align="center">Black（黑）</td>
<td align="center">(0, 0, 0)</td>
<td align="center">Purple（紫）</td>
<td align="center">(128, 0, 128)</td>
</tr>
</tbody></table>
</li>
<li><p>像素。对于一个由数字序列表示的图像来说，最小的单位就是图像上单一颜色的小方格，这些小方块都有一个明确的位置和被分配的色彩数值，而这些一小方格的颜色和位置决定了该图像最终呈现出来的样子，它们是不可分割的单位，我们通常称之为像素（pixel）。每一个图像都包含了一定量的像素，这些像素决定图像在屏幕上所呈现的大小，大家如果爱好拍照或者自拍，对像素这个词就不会陌生。</p>
</li>
</ol>
<h3 id="用Pillow处理图像"><a href="#用Pillow处理图像" class="headerlink" title="用Pillow处理图像"></a>用Pillow处理图像</h3><p>Pillow是由从著名的Python图像处理库PIL发展出来的一个分支，通过Pillow可以实现图像压缩和图像处理等各种操作。可以使用下面的命令来安装Pillow。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pillow</span><br></pre></td></tr></table></figure>

<p>Pillow中最为重要的是<code>Image</code>类，可以通过<code>Image</code>模块的<code>open</code>函数来读取图像并获得<code>Image</code>类型的对象。</p>
<ol>
<li><p>读取和显示图像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取图像获得Image对象</span></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>)</span><br><span class="line"><span class="comment"># 通过Image对象的format属性获得图像的格式</span></span><br><span class="line"><span class="built_in">print</span>(image.<span class="built_in">format</span>) <span class="comment"># JPEG</span></span><br><span class="line"><span class="comment"># 通过Image对象的size属性获得图像的尺寸</span></span><br><span class="line"><span class="built_in">print</span>(image.size)   <span class="comment"># (500, 750)</span></span><br><span class="line"><span class="comment"># 通过Image对象的mode属性获取图像的模式</span></span><br><span class="line"><span class="built_in">print</span>(image.mode)   <span class="comment"># RGB</span></span><br><span class="line"><span class="comment"># 通过Image对象的show方法显示图像</span></span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202628.png" width="80%"></li>
<li><p>剪裁图像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过Image对象的crop方法指定剪裁区域剪裁图像</span></span><br><span class="line">image.crop((<span class="number">80</span>, <span class="number">20</span>, <span class="number">310</span>, <span class="number">360</span>)).show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202701.png" width="80%"></li>
<li><p>生成缩略图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过Image对象的thumbnail方法生成指定尺寸的缩略图</span></span><br><span class="line">image.thumbnail((<span class="number">128</span>, <span class="number">128</span>))</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202722.png" width="100%"></li>
<li><p>缩放和黏贴图像</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取骆昊的照片获得Image对象</span></span><br><span class="line">luohao_image = Image.<span class="built_in">open</span>(<span class="string">&#x27;luohao.png&#x27;</span>)</span><br><span class="line"><span class="comment"># 读取吉多的照片获得Image对象</span></span><br><span class="line">guido_image = Image.<span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>)</span><br><span class="line"><span class="comment"># 从吉多的照片上剪裁出吉多的头</span></span><br><span class="line">guido_head = guido_image.crop((<span class="number">80</span>, <span class="number">20</span>, <span class="number">310</span>, <span class="number">360</span>))</span><br><span class="line">width, height = guido_head.size</span><br><span class="line"><span class="comment"># 使用Image对象的resize方法修改图像的尺寸</span></span><br><span class="line"><span class="comment"># 使用Image对象的paste方法将吉多的头粘贴到骆昊的照片上</span></span><br><span class="line">luohao_image.paste(guido_head.resize((<span class="built_in">int</span>(width / <span class="number">1.5</span>), <span class="built_in">int</span>(height / <span class="number">1.5</span>))), (<span class="number">172</span>, <span class="number">40</span>))</span><br><span class="line">luohao_image.show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202749.png" width="80%"></li>
<li><p>旋转和翻转</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>)</span><br><span class="line"><span class="comment"># 使用Image对象的rotate方法实现图像的旋转</span></span><br><span class="line">image.rotate(<span class="number">45</span>).show()</span><br><span class="line"><span class="comment"># 使用Image对象的transpose方法实现图像翻转</span></span><br><span class="line"><span class="comment"># Image.FLIP_LEFT_RIGHT - 水平翻转</span></span><br><span class="line"><span class="comment"># Image.FLIP_TOP_BOTTOM - 垂直翻转</span></span><br><span class="line">image.transpose(Image.FLIP_TOP_BOTTOM).show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202829.png" width="80%"></li>
<li><p>操作像素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>, <span class="number">310</span>):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>, <span class="number">360</span>):</span><br><span class="line">        <span class="comment"># 通过Image对象的putpixel方法修改图像指定像素点</span></span><br><span class="line">        image.putpixel((x, y), (<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>))</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202932.png" width="80%"></li>
<li><p>滤镜效果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageFilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Image对象的filter方法对图像进行滤镜处理</span></span><br><span class="line"><span class="comment"># ImageFilter模块包含了诸多预设的滤镜也可以自定义滤镜</span></span><br><span class="line">image.<span class="built_in">filter</span>(ImageFilter.CONTOUR).show()</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803202953.png" width="80%"></li>
</ol>
<h3 id="使用Pillow绘图"><a href="#使用Pillow绘图" class="headerlink" title="使用Pillow绘图"></a>使用Pillow绘图</h3><p>Pillow中有一个名为<code>ImageDraw</code>的模块，该模块的<code>Draw</code>函数会返回一个<code>ImageDraw</code>对象，通过<code>ImageDraw</code>对象的<code>arc</code>、<code>line</code>、<code>rectangle</code>、<code>ellipse</code>、<code>polygon</code>等方法，可以在图像上绘制出圆弧、线条、矩形、椭圆、多边形等形状，也可以通过该对象的<code>text</code>方法在图像上添加文字。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803203016.png" width="80%">

<p>要绘制如上图所示的图像，完整的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_color</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成随机颜色&quot;&quot;&quot;</span></span><br><span class="line">    red = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    green = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    blue = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">return</span> red, green, blue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">width, height = <span class="number">800</span>, <span class="number">600</span></span><br><span class="line"><span class="comment"># 创建一个800*600的图像，背景色为白色</span></span><br><span class="line">image = Image.new(mode=<span class="string">&#x27;RGB&#x27;</span>, size=(width, height), color=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line"><span class="comment"># 创建一个ImageDraw对象</span></span><br><span class="line">drawer = ImageDraw.Draw(image)</span><br><span class="line"><span class="comment"># 通过指定字体和大小获得ImageFont对象</span></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;Kongxin.ttf&#x27;</span>, <span class="number">32</span>)</span><br><span class="line"><span class="comment"># 通过ImageDraw对象的text方法绘制文字</span></span><br><span class="line">drawer.text((<span class="number">300</span>, <span class="number">50</span>), <span class="string">&#x27;Hello, world!&#x27;</span>, fill=(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), font=font)</span><br><span class="line"><span class="comment"># 通过ImageDraw对象的line方法绘制两条对角直线</span></span><br><span class="line">drawer.line((<span class="number">0</span>, <span class="number">0</span>, width, height), fill=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), width=<span class="number">2</span>)</span><br><span class="line">drawer.line((width, <span class="number">0</span>, <span class="number">0</span>, height), fill=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), width=<span class="number">2</span>)</span><br><span class="line">xy = width // <span class="number">2</span> - <span class="number">60</span>, height // <span class="number">2</span> - <span class="number">60</span>, width // <span class="number">2</span> + <span class="number">60</span>, height // <span class="number">2</span> + <span class="number">60</span></span><br><span class="line"><span class="comment"># 通过ImageDraw对象的rectangle方法绘制矩形</span></span><br><span class="line">drawer.rectangle(xy, outline=(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), width=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 通过ImageDraw对象的ellipse方法绘制椭圆</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    left, top, right, bottom = <span class="number">150</span> + i * <span class="number">120</span>, <span class="number">220</span>, <span class="number">310</span> + i * <span class="number">120</span>, <span class="number">380</span></span><br><span class="line">    drawer.ellipse((left, top, right, bottom), outline=random_color(), width=<span class="number">8</span>)</span><br><span class="line"><span class="comment"># 显示图像</span></span><br><span class="line">image.show()</span><br><span class="line"><span class="comment"># 保存图像</span></span><br><span class="line">image.save(<span class="string">&#x27;result.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：上面代码中使用的字体文件需要根据自己准备，可以选择自己喜欢的字体文件并放置在代码目录下。</p>
</blockquote>
<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>使用Python语言做开发，除了可以用Pillow来处理图像外，还可以使用更为强大的OpenCV库来完成图形图像的处理，OpenCV（<strong>Open</strong> Source <strong>C</strong>omputer <strong>V</strong>ision Library）是一个跨平台的计算机视觉库，可以用来开发实时图像处理、计算机视觉和模式识别程序。在我们的日常工作中，有很多繁琐乏味的任务其实都可以通过Python程序来处理，编程的目的就是让计算机帮助我们解决问题，减少重复乏味的劳动。通过本章节的学习，相信大家已经感受到了使用Python程序绘图P图的乐趣，其实Python能做的事情还远不止这些，继续你的学习吧。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第28课：用Python处理图像/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC27%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E6%93%8D%E4%BD%9CPDF%E6%96%87%E4%BB%B6/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.321Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第27课：用Python操作PDF文件PDF是Portable Document Format的缩写，这类文件通常使用.pdf作为其扩展名。在日常开发工作中，最容易遇到的就是从PDF中读取文本内容以及用已有的内容生成PDF文档这两个任务。
从PDF中提取文本在Python中，可以使用名为PyPDF2的三方库来读取PDF文件，可以使用下面的命令来安装它。
1pip install PyPDF2

PyPDF2没有办法从PDF文档中提取图像、图表或其他媒体，但它可以提取文本，并将其返回为Python字符串。
12345import PyPDF2reader = PyPDF2.PdfFileReader(&#x27;test.pdf&#x27;)page = reader.getPage(0)print(page.extractText())


提示：上面代码中使用的PDF文件“test.pdf”以及下面的代码中需要用到的PDF文件，都可以通过后面的百度云盘地址进行获取。链接:https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g 提取码:e7b4。 -->
        <!-- </div> -->

        
        <h2 id="第27课：用Python操作PDF文件"><a href="#第27课：用Python操作PDF文件" class="headerlink" title="第27课：用Python操作PDF文件"></a>第27课：用Python操作PDF文件</h2><p>PDF是Portable Document Format的缩写，这类文件通常使用<code>.pdf</code>作为其扩展名。在日常开发工作中，最容易遇到的就是从PDF中读取文本内容以及用已有的内容生成PDF文档这两个任务。</p>
<h3 id="从PDF中提取文本"><a href="#从PDF中提取文本" class="headerlink" title="从PDF中提取文本"></a>从PDF中提取文本</h3><p>在Python中，可以使用名为<code>PyPDF2</code>的三方库来读取PDF文件，可以使用下面的命令来安装它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyPDF2</span><br></pre></td></tr></table></figure>

<p><code>PyPDF2</code>没有办法从PDF文档中提取图像、图表或其他媒体，但它可以提取文本，并将其返回为Python字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"></span><br><span class="line">reader = PyPDF2.PdfFileReader(<span class="string">&#x27;test.pdf&#x27;</span>)</span><br><span class="line">page = reader.getPage(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(page.extractText())</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示</strong>：上面代码中使用的PDF文件“test.pdf”以及下面的代码中需要用到的PDF文件，都可以通过后面的百度云盘地址进行获取。链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</a> 提取码:e7b4。</p>
</blockquote>
<p>当然，<code>PyPDF2</code>并不是什么样的PDF文档都能提取出文字来，这个问题就我所知并没有什么特别好的解决方法，尤其是在提取中文的时候。网上也有很多讲解从PDF中提取文字的文章，推荐大家自行阅读<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1395339">《三大神器助力Python提取pdf文档信息》</a>一文进行了解。</p>
<p>要从PDF文件中提取文本也可以直接使用三方的命令行工具，具体的做法如下所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pdfminer.six</span><br><span class="line">pdf2text.py test.pdf</span><br></pre></td></tr></table></figure>

<h3 id="旋转和叠加页面"><a href="#旋转和叠加页面" class="headerlink" title="旋转和叠加页面"></a>旋转和叠加页面</h3><p>上面的代码中通过创建<code>PdfFileReader</code>对象的方式来读取PDF文档，该对象的<code>getPage</code>方法可以获得PDF文档的指定页并得到一个<code>PageObject</code>对象，通过<code>PageObject</code>对象的<code>rotateClockwise</code>和<code>rotateCounterClockwise</code>方法可以实现页面的顺时针和逆时针方向旋转，通过<code>PageObject</code>对象的<code>addBlankPage</code>方法可以添加一个新的空白页，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PyPDF2.pdf <span class="keyword">import</span> PageObject</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个读PDF文件的Reader对象</span></span><br><span class="line">reader = PyPDF2.PdfFileReader(<span class="string">&#x27;resources/XGBoost.pdf&#x27;</span>)</span><br><span class="line"><span class="comment"># 创建一个写PDF文件的Writer对象</span></span><br><span class="line">writer = PyPDF2.PdfFileWriter()</span><br><span class="line"><span class="comment"># 对PDF文件所有页进行循环遍历</span></span><br><span class="line"><span class="keyword">for</span> page_num <span class="keyword">in</span> <span class="built_in">range</span>(reader.numPages):</span><br><span class="line">    <span class="comment"># 获取指定页码的Page对象</span></span><br><span class="line">    current_page = reader.getPage(page_num)  <span class="comment"># type: PageObject</span></span><br><span class="line">    <span class="keyword">if</span> page_num % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># 奇数页顺时针旋转90度</span></span><br><span class="line">        current_page.rotateClockwise(<span class="number">90</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 偶数页反时针旋转90度</span></span><br><span class="line">        current_page.rotateCounterClockwise(<span class="number">90</span>)</span><br><span class="line">    writer.addPage(current_page)</span><br><span class="line"><span class="comment"># 最后添加一个空白页并旋转90度</span></span><br><span class="line">page = writer.addBlankPage()  <span class="comment"># type: PageObject</span></span><br><span class="line">page.rotateClockwise(<span class="number">90</span>)</span><br><span class="line"><span class="comment"># 通过Writer对象的write方法将PDF写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;resources/XGBoost-modified.pdf&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer.write(file)</span><br></pre></td></tr></table></figure>

<h3 id="加密PDF文件"><a href="#加密PDF文件" class="headerlink" title="加密PDF文件"></a>加密PDF文件</h3><p>使用<code>PyPDF2</code>中的<code>PdfFileWrite</code>对象可以为PDF文档加密，如果需要给一系列的PDF文档设置统一的访问口令，使用Python程序来处理就会非常的方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"></span><br><span class="line">reader = PyPDF2.PdfFileReader(<span class="string">&#x27;resources/XGBoost.pdf&#x27;</span>)</span><br><span class="line">writer = PyPDF2.PdfFileWriter()</span><br><span class="line"><span class="keyword">for</span> page_num <span class="keyword">in</span> <span class="built_in">range</span>(reader.numPages):</span><br><span class="line">    writer.addPage(reader.getPage(page_num))</span><br><span class="line"><span class="comment"># 通过encrypt方法加密PDF文件，方法的参数就是设置的密码</span></span><br><span class="line">writer.encrypt(<span class="string">&#x27;foobared&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;resources/XGBoost-encrypted.pdf&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer.write(file)</span><br></pre></td></tr></table></figure>

<h3 id="批量添加水印"><a href="#批量添加水印" class="headerlink" title="批量添加水印"></a>批量添加水印</h3><p>上面提到的<code>PageObject</code>对象还有一个名为<code>mergePage</code>的方法，可以两个PDF页面进行叠加，通过这个操作，我们很容易实现给PDF文件添加水印的功能。例如要给上面的“XGBoost.pdf”文件添加一个水印，我们可以先准备好一个提供水印页面的PDF文件，然后将包含水印的<code>PageObject</code>读取出来，然后再循环遍历“XGBoost.pdf”文件的每个页，获取到<code>PageObject</code>对象，然后通过<code>mergePage</code>方法实现水印页和原始页的合并，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PyPDF2.pdf <span class="keyword">import</span> PageObject</span><br><span class="line"></span><br><span class="line">reader1 = PyPDF2.PdfFileReader(<span class="string">&#x27;resources/XGBoost.pdf&#x27;</span>)</span><br><span class="line">reader2 = PyPDF2.PdfFileReader(<span class="string">&#x27;resources/watermark.pdf&#x27;</span>)</span><br><span class="line">writer = PyPDF2.PdfFileWriter()</span><br><span class="line"><span class="comment"># 获取水印页</span></span><br><span class="line">watermark_page = reader2.getPage(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> page_num <span class="keyword">in</span> <span class="built_in">range</span>(reader1.numPages):</span><br><span class="line">    current_page = reader1.getPage(page_num)  <span class="comment"># type: PageObject</span></span><br><span class="line">    current_page.mergePage(watermark_page)</span><br><span class="line">    <span class="comment"># 将原始页和水印页进行合并</span></span><br><span class="line">    writer.addPage(current_page)</span><br><span class="line"><span class="comment"># 将PDF写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;resources/XGBoost-watermarked.pdf&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer.write(file)</span><br></pre></td></tr></table></figure>

<p>如果愿意，还可以让奇数页和偶数页使用不同的水印，大家可以自己思考下应该怎么做。</p>
<h3 id="创建PDF文件"><a href="#创建PDF文件" class="headerlink" title="创建PDF文件"></a>创建PDF文件</h3><p>创建PDF文档需要三方库<code>reportlab</code>的支持，安装的方法如下所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install reportlab</span><br></pre></td></tr></table></figure>

<p>下面通过一个例子为大家展示<code>reportlab</code>的用法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> reportlab.lib.pagesizes <span class="keyword">import</span> A4</span><br><span class="line"><span class="keyword">from</span> reportlab.pdfbase <span class="keyword">import</span> pdfmetrics</span><br><span class="line"><span class="keyword">from</span> reportlab.pdfbase.ttfonts <span class="keyword">import</span> TTFont</span><br><span class="line"><span class="keyword">from</span> reportlab.pdfgen <span class="keyword">import</span> canvas</span><br><span class="line"></span><br><span class="line">pdf_canvas = canvas.Canvas(<span class="string">&#x27;resources/demo.pdf&#x27;</span>, pagesize=A4)</span><br><span class="line">width, height = A4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘图</span></span><br><span class="line">image = canvas.ImageReader(<span class="string">&#x27;resources/guido.jpg&#x27;</span>)</span><br><span class="line">pdf_canvas.drawImage(image, <span class="number">20</span>, height - <span class="number">395</span>, <span class="number">250</span>, <span class="number">375</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前页</span></span><br><span class="line">pdf_canvas.showPage()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册字体文件</span></span><br><span class="line">pdfmetrics.registerFont(TTFont(<span class="string">&#x27;Font1&#x27;</span>, <span class="string">&#x27;resources/fonts/Vera.ttf&#x27;</span>))</span><br><span class="line">pdfmetrics.registerFont(TTFont(<span class="string">&#x27;Font2&#x27;</span>, <span class="string">&#x27;resources/fonts/青呱石头体.ttf&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写字</span></span><br><span class="line">pdf_canvas.setFont(<span class="string">&#x27;Font2&#x27;</span>, <span class="number">40</span>)</span><br><span class="line">pdf_canvas.setFillColorRGB(<span class="number">0.9</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">1</span>)</span><br><span class="line">pdf_canvas.drawString(width // <span class="number">2</span> - <span class="number">120</span>, height // <span class="number">2</span>, <span class="string">&#x27;你好，世界！&#x27;</span>)</span><br><span class="line">pdf_canvas.setFont(<span class="string">&#x27;Font1&#x27;</span>, <span class="number">40</span>)</span><br><span class="line">pdf_canvas.setFillColorRGB(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0.5</span>)</span><br><span class="line">pdf_canvas.rotate(<span class="number">18</span>)</span><br><span class="line">pdf_canvas.drawString(<span class="number">250</span>, <span class="number">250</span>, <span class="string">&#x27;hello, world!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存</span></span><br><span class="line">pdf_canvas.save()</span><br></pre></td></tr></table></figure>

<p>上面的代码如果不太理解也没有关系，等真正需要用Python创建PDF文档的时候，再好好研读一下<code>reportlab</code>的<a target="_blank" rel="noopener" href="https://www.reportlab.com/docs/reportlab-userguide.pdf">官方文档</a>就可以了。</p>
<blockquote>
<p><strong>提示</strong>：上面代码中用到的图片和字体，可以在后面的百度云盘链接中获取。链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</a> 提取码:e7b4。</p>
</blockquote>
<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>在学习完上面的内容之后，相信大家已经知道像合并多个PDF文件这样的工作应该如何用Python代码来处理了，赶紧自己动手试一试吧。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第27课：用Python操作PDF文件/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC26%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E6%93%8D%E4%BD%9CWord%E6%96%87%E4%BB%B6%E5%92%8CPowerPoint/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.313Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第26课：用Python操作Word和PowerPoint在日常工作中，有很多简单重复的劳动其实完全可以交给Python程序，比如根据样板文件（模板文件）批量的生成很多个Word文件或PowerPoint文件。Word是微软公司开发的文字处理程序，相信大家都不陌生，日常办公中很多正式的文档都是用Word进行撰写和编辑的，目前使用的Word文件后缀名一般为.docx。PowerPoint是微软公司开发的演示文稿程序，是微软的Office系列软件中的一员，被商业人士、教师、学生等群体广泛使用，通常也将其称之为“幻灯片”。在Python中，可以使用名为python-docx 的三方库来操作Word，可以使用名为python-pptx的三方库来生成PowerPoint。
操作Word文档我们可以先通过下面的命令来安装python-docx三方库。
1pip install python-docx

按照官方文档的介绍，我们可以使用如下所示的代码来生成一个简单的Word文档。
123456789101112131415161718192021222324252627282930313233343 -->
        <!-- </div> -->

        
        <h2 id="第26课：用Python操作Word和PowerPoint"><a href="#第26课：用Python操作Word和PowerPoint" class="headerlink" title="第26课：用Python操作Word和PowerPoint"></a>第26课：用Python操作Word和PowerPoint</h2><p>在日常工作中，有很多简单重复的劳动其实完全可以交给Python程序，比如根据样板文件（模板文件）批量的生成很多个Word文件或PowerPoint文件。Word是微软公司开发的文字处理程序，相信大家都不陌生，日常办公中很多正式的文档都是用Word进行撰写和编辑的，目前使用的Word文件后缀名一般为<code>.docx</code>。PowerPoint是微软公司开发的演示文稿程序，是微软的Office系列软件中的一员，被商业人士、教师、学生等群体广泛使用，通常也将其称之为“幻灯片”。在Python中，可以使用名为<code>python-docx</code> 的三方库来操作Word，可以使用名为<code>python-pptx</code>的三方库来生成PowerPoint。</p>
<h3 id="操作Word文档"><a href="#操作Word文档" class="headerlink" title="操作Word文档"></a>操作Word文档</h3><p>我们可以先通过下面的命令来安装<code>python-docx</code>三方库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-docx</span><br></pre></td></tr></table></figure>

<p>按照<a target="_blank" rel="noopener" href="https://python-docx.readthedocs.io/en/latest/">官方文档</a>的介绍，我们可以使用如下所示的代码来生成一个简单的Word文档。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> Cm, Pt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx.document <span class="keyword">import</span> Document <span class="keyword">as</span> Doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建代表Word文档的Doc对象</span></span><br><span class="line">document = Document()  <span class="comment"># type: Doc</span></span><br><span class="line"><span class="comment"># 添加大标题</span></span><br><span class="line">document.add_heading(<span class="string">&#x27;快快乐乐学Python&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># 添加段落</span></span><br><span class="line">p = document.add_paragraph(<span class="string">&#x27;Python是一门非常流行的编程语言，它&#x27;</span>)</span><br><span class="line">run = p.add_run(<span class="string">&#x27;简单&#x27;</span>)</span><br><span class="line">run.bold = <span class="literal">True</span></span><br><span class="line">run.font.size = Pt(<span class="number">18</span>)</span><br><span class="line">p.add_run(<span class="string">&#x27;而且&#x27;</span>)</span><br><span class="line">run = p.add_run(<span class="string">&#x27;优雅&#x27;</span>)</span><br><span class="line">run.font.size = Pt(<span class="number">18</span>)</span><br><span class="line">run.underline = <span class="literal">True</span></span><br><span class="line">p.add_run(<span class="string">&#x27;。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一级标题</span></span><br><span class="line">document.add_heading(<span class="string">&#x27;Heading, level 1&#x27;</span>, level=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 添加带样式的段落</span></span><br><span class="line">document.add_paragraph(<span class="string">&#x27;Intense quote&#x27;</span>, style=<span class="string">&#x27;Intense Quote&#x27;</span>)</span><br><span class="line"><span class="comment"># 添加无序列表</span></span><br><span class="line">document.add_paragraph(</span><br><span class="line">    <span class="string">&#x27;first item in unordered list&#x27;</span>, style=<span class="string">&#x27;List Bullet&#x27;</span></span><br><span class="line">)</span><br><span class="line">document.add_paragraph(</span><br><span class="line">    <span class="string">&#x27;second item in ordered list&#x27;</span>, style=<span class="string">&#x27;List Bullet&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 添加有序列表</span></span><br><span class="line">document.add_paragraph(</span><br><span class="line">    <span class="string">&#x27;first item in ordered list&#x27;</span>, style=<span class="string">&#x27;List Number&#x27;</span></span><br><span class="line">)</span><br><span class="line">document.add_paragraph(</span><br><span class="line">    <span class="string">&#x27;second item in ordered list&#x27;</span>, style=<span class="string">&#x27;List Number&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加图片（注意路径和图片必须要存在）</span></span><br><span class="line">document.add_picture(<span class="string">&#x27;resources/guido.jpg&#x27;</span>, width=Cm(<span class="number">5.2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加分节符</span></span><br><span class="line">document.add_section()</span><br><span class="line"></span><br><span class="line">records = (</span><br><span class="line">    (<span class="string">&#x27;骆昊&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1995-5-5&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;孙美丽&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1992-2-2&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 添加表格</span></span><br><span class="line">table = document.add_table(rows=<span class="number">1</span>, cols=<span class="number">3</span>)</span><br><span class="line">table.style = <span class="string">&#x27;Dark List&#x27;</span></span><br><span class="line">hdr_cells = table.rows[<span class="number">0</span>].cells</span><br><span class="line">hdr_cells[<span class="number">0</span>].text = <span class="string">&#x27;姓名&#x27;</span></span><br><span class="line">hdr_cells[<span class="number">1</span>].text = <span class="string">&#x27;性别&#x27;</span></span><br><span class="line">hdr_cells[<span class="number">2</span>].text = <span class="string">&#x27;出生日期&#x27;</span></span><br><span class="line"><span class="comment"># 为表格添加行</span></span><br><span class="line"><span class="keyword">for</span> name, sex, birthday <span class="keyword">in</span> records:</span><br><span class="line">    row_cells = table.add_row().cells</span><br><span class="line">    row_cells[<span class="number">0</span>].text = name</span><br><span class="line">    row_cells[<span class="number">1</span>].text = sex</span><br><span class="line">    row_cells[<span class="number">2</span>].text = birthday</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加分页符</span></span><br><span class="line">document.add_page_break()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存文档</span></span><br><span class="line">document.save(<span class="string">&#x27;demo.docx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示</strong>：上面代码第7行中的注释<code># type: Doc</code>是为了在PyCharm中获得代码补全提示，因为如果不清楚对象具体的数据类型，PyCharm无法在后续代码中给出<code>Doc</code>对象的代码补全提示。</p>
</blockquote>
<p>执行上面的代码，打开生成的Word文档，效果如下图所示。</p>
<p><img src="https://gitee.com/jackfrued/mypic/raw/master/20210820002742.png" alt="image-20210820002742341" width="40%">&nbsp;&nbsp;<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820002843.png" alt="image-20210820002843696" width="40%"></p>
<p>对于一个已经存在的Word文件，我们可以通过下面的代码去遍历它所有的段落并获取对应的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> docx.document <span class="keyword">import</span> Document <span class="keyword">as</span> Doc</span><br><span class="line"></span><br><span class="line">doc = Document(<span class="string">&#x27;resources/离职证明.docx&#x27;</span>)  <span class="comment"># type: Doc</span></span><br><span class="line"><span class="keyword">for</span> no, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(doc.paragraphs):</span><br><span class="line">    <span class="built_in">print</span>(no, p.text)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示</strong>：如果需要上面代码中的Word文件，可以通过下面的百度云盘地址进行获取。链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</a> 提取码:e7b4。</p>
</blockquote>
<p>读取到的内容如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0 </span><br><span class="line">1 离 职 证 明</span><br><span class="line">2 </span><br><span class="line">3 兹证明 王大锤 ，身份证号码： 100200199512120001 ，于 2018 年 8 月 7 日至 2020 年 6 月 28 日在我单位  开发部 部门担任 Java开发工程师 职务，在职期间无不良表现。因 个人 原因，于 2020 年 6 月 28 日起终止解除劳动合同。现已结清财务相关费用，办理完解除劳动关系相关手续，双方不存在任何劳动争议。</span><br><span class="line">4 </span><br><span class="line">5 特此证明！</span><br><span class="line">6 </span><br><span class="line">7 </span><br><span class="line">8 公司名称（盖章）:成都风车车科技有限公司</span><br><span class="line">9    			2020 年 6 月 28 日</span><br></pre></td></tr></table></figure>

<p>讲到这里，相信很多读者已经想到了，我们可以把上面的离职证明制作成一个模板文件，把姓名、身份证号、入职和离职日期等信息用占位符代替，这样通过对占位符的替换，就可以根据实际需要写入对应的信息，这样就可以批量的生成Word文档。</p>
<p>按照上面的思路，我们首先编辑一个离职证明的模板文件，如下图所示。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820004223.png" alt="image-20210820004223731" width="75%" style="border:1px solid black"/>

<p>接下来我们读取该文件，将占位符替换为真实信息，就可以生成一个新的Word文档，如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> docx.document <span class="keyword">import</span> Document <span class="keyword">as</span> Doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将真实信息用字典的方式保存在列表中</span></span><br><span class="line">employees = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;骆昊&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;100200198011280001&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sdate&#x27;</span>: <span class="string">&#x27;2008年3月1日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;edate&#x27;</span>: <span class="string">&#x27;2012年2月29日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;department&#x27;</span>: <span class="string">&#x27;产品研发&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;架构师&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;company&#x27;</span>: <span class="string">&#x27;成都华为技术有限公司&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;王大锤&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;510210199012125566&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sdate&#x27;</span>: <span class="string">&#x27;2019年1月1日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;edate&#x27;</span>: <span class="string">&#x27;2021年4月30日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;department&#x27;</span>: <span class="string">&#x27;产品研发&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;Python开发工程师&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;company&#x27;</span>: <span class="string">&#x27;成都谷道科技有限公司&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;李元芳&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2102101995103221599&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sdate&#x27;</span>: <span class="string">&#x27;2020年5月10日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;edate&#x27;</span>: <span class="string">&#x27;2021年3月5日&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;department&#x27;</span>: <span class="string">&#x27;产品研发&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;Java开发工程师&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;company&#x27;</span>: <span class="string">&#x27;同城企业管理集团有限公司&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 对列表进行循环遍历，批量生成Word文档 </span></span><br><span class="line"><span class="keyword">for</span> emp_dict <span class="keyword">in</span> employees:</span><br><span class="line">    <span class="comment"># 读取离职证明模板文件</span></span><br><span class="line">    doc = Document(<span class="string">&#x27;resources/离职证明模板.docx&#x27;</span>)  <span class="comment"># type: Doc</span></span><br><span class="line">    <span class="comment"># 循环遍历所有段落寻找占位符</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> doc.paragraphs:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> p.text:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># 不能直接修改段落内容，否则会丢失样式</span></span><br><span class="line">        <span class="comment"># 所以需要对段落中的元素进行遍历并进行查找替换</span></span><br><span class="line">        <span class="keyword">for</span> run <span class="keyword">in</span> p.runs:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> run.text:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># 将占位符换成实际内容</span></span><br><span class="line">            start, end = run.text.find(<span class="string">&#x27;&#123;&#x27;</span>), run.text.find(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">            key, place_holder = run.text[start + <span class="number">1</span>:end], run.text[start:end + <span class="number">1</span>]</span><br><span class="line">            run.text = run.text.replace(place_holder, emp_dict[key])</span><br><span class="line">    <span class="comment"># 每个人对应保存一个Word文档</span></span><br><span class="line">    doc.save(<span class="string">f&#x27;<span class="subst">&#123;emp_dict[<span class="string">&quot;name&quot;</span>]&#125;</span>离职证明.docx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>执行上面的代码，会在当前路径下生成三个Word文档，如下图所示。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820004825.png" alt="image-20210820004825183" width="50%">

<h3 id="生成PowerPoint"><a href="#生成PowerPoint" class="headerlink" title="生成PowerPoint"></a>生成PowerPoint</h3><p>首先我们需要安装名为<code>python-pptx</code>的三方库，命令如下所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-pptx</span><br></pre></td></tr></table></figure>

<p>用Python操作PowerPoint的内容，因为实际应用场景不算很多，我不打算在这里进行赘述，有兴趣的读者可以自行阅读<code>python-pptx</code>的<a target="_blank" rel="noopener" href="https://python-pptx.readthedocs.io/en/latest/">官方文档</a>，下面仅展示一段来自于官方文档的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pptx <span class="keyword">import</span> Presentation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建幻灯片对象</span></span><br><span class="line">pres = Presentation()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择母版添加一页</span></span><br><span class="line">title_slide_layout = pres.slide_layouts[<span class="number">0</span>]</span><br><span class="line">slide = pres.slides.add_slide(title_slide_layout)</span><br><span class="line"><span class="comment"># 获取标题栏和副标题栏</span></span><br><span class="line">title = slide.shapes.title</span><br><span class="line">subtitle = slide.placeholders[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 编辑标题和副标题</span></span><br><span class="line">title.text = <span class="string">&quot;Welcome to Python&quot;</span></span><br><span class="line">subtitle.text = <span class="string">&quot;Life is short, I use Python&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择母版添加一页</span></span><br><span class="line">bullet_slide_layout = pres.slide_layouts[<span class="number">1</span>]</span><br><span class="line">slide = pres.slides.add_slide(bullet_slide_layout)</span><br><span class="line"><span class="comment"># 获取页面上所有形状</span></span><br><span class="line">shapes = slide.shapes</span><br><span class="line"><span class="comment"># 获取标题和主体</span></span><br><span class="line">title_shape = shapes.title</span><br><span class="line">body_shape = shapes.placeholders[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 编辑标题</span></span><br><span class="line">title_shape.text = <span class="string">&#x27;Introduction&#x27;</span></span><br><span class="line"><span class="comment"># 编辑主体内容</span></span><br><span class="line">tf = body_shape.text_frame</span><br><span class="line">tf.text = <span class="string">&#x27;History of Python&#x27;</span></span><br><span class="line"><span class="comment"># 添加一个一级段落</span></span><br><span class="line">p = tf.add_paragraph()</span><br><span class="line">p.text = <span class="string">&#x27;X\&#x27;max 1989&#x27;</span></span><br><span class="line">p.level = <span class="number">1</span></span><br><span class="line"><span class="comment"># 添加一个二级段落</span></span><br><span class="line">p = tf.add_paragraph()</span><br><span class="line">p.text = <span class="string">&#x27;Guido began to write interpreter for Python.&#x27;</span></span><br><span class="line">p.level = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存幻灯片</span></span><br><span class="line">pres.save(<span class="string">&#x27;test.pptx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>运行上面的代码，生成的PowerPoint文件如下图所示。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210820010306.png" alt="image-20210820010306008" width="75%" />

<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>用Python程序解决办公自动化的问题真的非常酷，它可以将我们从繁琐乏味的劳动中解放出来。写这类代码就是去做一件一劳永逸的事情，写代码的过程即便不怎么愉快，使用这些代码的时候应该是非常开心的。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第26课：用Python操作Word文件和PowerPoint/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC25%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E8%AF%BB%E5%86%99Excel%E6%96%87%E4%BB%B6-2/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.306Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第25课：用Python读写Excel文件-2Excel简介Excel是Microsoft（微软）为使用Windows和macOS操作系统开发的一款电子表格软件。Excel凭借其直观的界面、出色的计算功能和图表工具，再加上成功的市场营销，一直以来都是最为流行的个人计算机数据处理软件。当然，Excel也有很多竞品，例如Google Sheets、LibreOffice Calc、Numbers等，这些竞品基本上也能够兼容Excel，至少能够读写较新版本的Excel文件，当然这些不是我们讨论的重点。掌握用Python程序操作Excel文件，可以让日常办公自动化的工作更加轻松愉快，而且在很多商业项目中，导入导出Excel文件都是特别常见的功能。
本章我们继续讲解基于另一个三方库openpyxl如何进行Excel文件操作，首先需要先安装它。
1pip install openpyxl

openpyxl的优点在于，当我们打开一个Excel文件后，既可以对它进行读操作，又可以对它进行写操作，而且在操作的便捷性上是优于xlwt和xlrd的。此外，如果要进行样式编辑和公式计算，使用openpyxl也 -->
        <!-- </div> -->

        
        <h2 id="第25课：用Python读写Excel文件-2"><a href="#第25课：用Python读写Excel文件-2" class="headerlink" title="第25课：用Python读写Excel文件-2"></a>第25课：用Python读写Excel文件-2</h2><h3 id="Excel简介"><a href="#Excel简介" class="headerlink" title="Excel简介"></a>Excel简介</h3><p>Excel是Microsoft（微软）为使用Windows和macOS操作系统开发的一款电子表格软件。Excel凭借其直观的界面、出色的计算功能和图表工具，再加上成功的市场营销，一直以来都是最为流行的个人计算机数据处理软件。当然，Excel也有很多竞品，例如Google Sheets、LibreOffice Calc、Numbers等，这些竞品基本上也能够兼容Excel，至少能够读写较新版本的Excel文件，当然这些不是我们讨论的重点。掌握用Python程序操作Excel文件，可以让日常办公自动化的工作更加轻松愉快，而且在很多商业项目中，导入导出Excel文件都是特别常见的功能。</p>
<p>本章我们继续讲解基于另一个三方库<code>openpyxl</code>如何进行Excel文件操作，首先需要先安装它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install openpyxl</span><br></pre></td></tr></table></figure>

<p><code>openpyxl</code>的优点在于，当我们打开一个Excel文件后，既可以对它进行读操作，又可以对它进行写操作，而且在操作的便捷性上是优于<code>xlwt</code>和<code>xlrd</code>的。此外，如果要进行样式编辑和公式计算，使用<code>openpyxl</code>也远比上一个章节我们讲解的方式更为简单，而且<code>openpyxl</code>还支持数据透视和插入图表等操作，功能非常强大。有一点需要再次强调，<code>openpyxl</code>并不支持操作Office 2007以前版本的Excel文件。</p>
<h3 id="读取Excel文件"><a href="#读取Excel文件" class="headerlink" title="读取Excel文件"></a>读取Excel文件</h3><p>例如在当前文件夹下有一个名为“阿里巴巴2020年股票数据.xlsx”的Excel文件，如果想读取并显示该文件的内容，可以通过如下所示的代码来完成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载一个工作簿 ---&gt; Workbook</span></span><br><span class="line">wb = openpyxl.load_workbook(<span class="string">&#x27;阿里巴巴2020年股票数据.xlsx&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取工作表的名字</span></span><br><span class="line"><span class="built_in">print</span>(wb.sheetnames)</span><br><span class="line"><span class="comment"># 获取工作表 ---&gt; Worksheet</span></span><br><span class="line">sheet = wb.worksheets[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 获得单元格的范围</span></span><br><span class="line"><span class="built_in">print</span>(sheet.dimensions)</span><br><span class="line"><span class="comment"># 获得行数和列数</span></span><br><span class="line"><span class="built_in">print</span>(sheet.max_row, sheet.max_column)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定单元格的值</span></span><br><span class="line"><span class="built_in">print</span>(sheet.cell(<span class="number">3</span>, <span class="number">3</span>).value)</span><br><span class="line"><span class="built_in">print</span>(sheet[<span class="string">&#x27;C3&#x27;</span>].value)</span><br><span class="line"><span class="built_in">print</span>(sheet[<span class="string">&#x27;G255&#x27;</span>].value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取多个单元格（嵌套元组）</span></span><br><span class="line"><span class="built_in">print</span>(sheet[<span class="string">&#x27;A2:C5&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取所有单元格的数据</span></span><br><span class="line"><span class="keyword">for</span> row_ch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, sheet.max_row + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> col_ch <span class="keyword">in</span> <span class="string">&#x27;ABCDEFG&#x27;</span>:</span><br><span class="line">        value = sheet[<span class="string">f&#x27;<span class="subst">&#123;col_ch&#125;</span><span class="subst">&#123;row_ch&#125;</span>&#x27;</span>].value</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(value) == datetime.datetime:</span><br><span class="line">            <span class="built_in">print</span>(value.strftime(<span class="string">&#x27;%Y年%m月%d日&#x27;</span>), end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">int</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;value:&lt;10d&#125;</span>&#x27;</span>, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">type</span>(value) == <span class="built_in">float</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;value:<span class="number">.4</span>f&#125;</span>&#x27;</span>, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(value, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示</strong>：上面代码中使用的Excel文件“阿里巴巴2020年股票数据.xlsx”可以通过后面的百度云盘地址进行获取。链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</a> 提取码:e7b4。</p>
</blockquote>
<p>需要提醒大家一点，<code>openpyxl</code>获取指定的单元格有两种方式，一种是通过<code>cell</code>方法，需要注意，该方法的行索引和列索引都是从<code>1</code>开始的，这是为了照顾用惯了Excel的人的习惯；另一种是通过索引运算，通过指定单元格的坐标，例如<code>C3</code>、<code>G255</code>，也可以取得对应的单元格，再通过单元格对象的<code>value</code>属性，就可以获取到单元格的值。通过上面的代码，相信大家还注意到了，可以通过类似<code>sheet[&#39;A2:C5&#39;]</code>或<code>sheet[&#39;A2&#39;:&#39;C5&#39;]</code>这样的切片操作获取多个单元格，该操作将返回嵌套的元组，相当于获取到了多行多列。</p>
<h3 id="写Excel文件"><a href="#写Excel文件" class="headerlink" title="写Excel文件"></a>写Excel文件</h3><p>下面我们使用<code>openpyxl</code>来进行写Excel操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：创建工作簿（Workbook）</span></span><br><span class="line">wb = openpyxl.Workbook()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步：添加工作表（Worksheet）</span></span><br><span class="line">sheet = wb.active</span><br><span class="line">sheet.title = <span class="string">&#x27;期末成绩&#x27;</span></span><br><span class="line"></span><br><span class="line">titles = (<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> col_index, title <span class="keyword">in</span> <span class="built_in">enumerate</span>(titles):</span><br><span class="line">    sheet.cell(<span class="number">1</span>, col_index + <span class="number">1</span>, title)</span><br><span class="line"></span><br><span class="line">names = (<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;赵云&#x27;</span>, <span class="string">&#x27;马超&#x27;</span>, <span class="string">&#x27;黄忠&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> row_index, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">    sheet.cell(row_index + <span class="number">2</span>, <span class="number">1</span>, name)</span><br><span class="line">    <span class="keyword">for</span> col_index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">5</span>):</span><br><span class="line">        sheet.cell(row_index + <span class="number">2</span>, col_index, random.randrange(<span class="number">50</span>, <span class="number">101</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第四步：保存工作簿</span></span><br><span class="line">wb.save(<span class="string">&#x27;考试成绩表.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="调整样式和公式计算"><a href="#调整样式和公式计算" class="headerlink" title="调整样式和公式计算"></a>调整样式和公式计算</h4><p>在使用<code>openpyxl</code>操作Excel时，如果要调整单元格的样式，可以直接通过单元格对象（<code>Cell</code>对象）的属性进行操作。单元格对象的属性包括字体（<code>font</code>）、对齐（<code>alignment</code>）、边框（<code>border</code>）等，具体的可以参考<code>openpyxl</code>的<a target="_blank" rel="noopener" href="https://openpyxl.readthedocs.io/en/stable/index.html">官方文档</a>。在使用<code>openpyxl</code>时，如果需要做公式计算，可以完全按照Excel中的操作方式来进行，具体的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font, Alignment, Border, Side</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对齐方式</span></span><br><span class="line">alignment = Alignment(horizontal=<span class="string">&#x27;center&#x27;</span>, vertical=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line"><span class="comment"># 边框线条</span></span><br><span class="line">side = Side(color=<span class="string">&#x27;ff7f50&#x27;</span>, style=<span class="string">&#x27;mediumDashed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">wb = openpyxl.load_workbook(<span class="string">&#x27;考试成绩表.xlsx&#x27;</span>)</span><br><span class="line">sheet = wb.worksheets[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整行高和列宽</span></span><br><span class="line">sheet.row_dimensions[<span class="number">1</span>].height = <span class="number">30</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;E&#x27;</span>].width = <span class="number">120</span></span><br><span class="line"></span><br><span class="line">sheet[<span class="string">&#x27;E1&#x27;</span>] = <span class="string">&#x27;平均分&#x27;</span></span><br><span class="line"><span class="comment"># 设置字体</span></span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">5</span>).font = Font(size=<span class="number">18</span>, bold=<span class="literal">True</span>, color=<span class="string">&#x27;ff1493&#x27;</span>, name=<span class="string">&#x27;华文楷体&#x27;</span>)</span><br><span class="line"><span class="comment"># 设置对齐方式</span></span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">5</span>).alignment = alignment</span><br><span class="line"><span class="comment"># 设置单元格边框</span></span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">5</span>).border = Border(left=side, top=side, right=side, bottom=side)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">7</span>):</span><br><span class="line">    <span class="comment"># 公式计算每个学生的平均分</span></span><br><span class="line">    sheet[<span class="string">f&#x27;E<span class="subst">&#123;i&#125;</span>&#x27;</span>] = <span class="string">f&#x27;=average(B<span class="subst">&#123;i&#125;</span>:D<span class="subst">&#123;i&#125;</span>)&#x27;</span></span><br><span class="line">    sheet.cell(i, <span class="number">5</span>).font = Font(size=<span class="number">12</span>, color=<span class="string">&#x27;4169e1&#x27;</span>, italic=<span class="literal">True</span>)</span><br><span class="line">    sheet.cell(i, <span class="number">5</span>).alignment = alignment</span><br><span class="line"></span><br><span class="line">wb.save(<span class="string">&#x27;考试成绩表.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="生成统计图表"><a href="#生成统计图表" class="headerlink" title="生成统计图表"></a>生成统计图表</h3><p>通过<code>openpyxl</code>库，可以直接向Excel中插入统计图表，具体的做法跟在Excel中插入图表大体一致。我们可以创建指定类型的图表对象，然后通过该对象的属性对图表进行设置。当然，最为重要的是为图表绑定数据，即横轴代表什么，纵轴代表什么，具体的数值是多少。最后，可以将图表对象添加到表单中，具体的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> BarChart, Reference</span><br><span class="line"></span><br><span class="line">wb = Workbook(write_only=<span class="literal">True</span>)</span><br><span class="line">sheet = wb.create_sheet()</span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">    (<span class="string">&#x27;类别&#x27;</span>, <span class="string">&#x27;销售A组&#x27;</span>, <span class="string">&#x27;销售B组&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;手机&#x27;</span>, <span class="number">40</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="string">&#x27;平板&#x27;</span>, <span class="number">50</span>, <span class="number">60</span>),</span><br><span class="line">    (<span class="string">&#x27;笔记本&#x27;</span>, <span class="number">80</span>, <span class="number">70</span>),</span><br><span class="line">    (<span class="string">&#x27;外围设备&#x27;</span>, <span class="number">20</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向表单中添加行</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">    sheet.append(row)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图表对象</span></span><br><span class="line">chart = BarChart()</span><br><span class="line">chart.<span class="built_in">type</span> = <span class="string">&#x27;col&#x27;</span></span><br><span class="line">chart.style = <span class="number">10</span></span><br><span class="line"><span class="comment"># 设置图表的标题</span></span><br><span class="line">chart.title = <span class="string">&#x27;销售统计图&#x27;</span></span><br><span class="line"><span class="comment"># 设置图表纵轴的标题</span></span><br><span class="line">chart.y_axis.title = <span class="string">&#x27;销量&#x27;</span></span><br><span class="line"><span class="comment"># 设置图表横轴的标题</span></span><br><span class="line">chart.x_axis.title = <span class="string">&#x27;商品类别&#x27;</span></span><br><span class="line"><span class="comment"># 设置数据的范围</span></span><br><span class="line">data = Reference(sheet, min_col=<span class="number">2</span>, min_row=<span class="number">1</span>, max_row=<span class="number">5</span>, max_col=<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 设置分类的范围</span></span><br><span class="line">cats = Reference(sheet, min_col=<span class="number">1</span>, min_row=<span class="number">2</span>, max_row=<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 给图表添加数据</span></span><br><span class="line">chart.add_data(data, titles_from_data=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 给图表设置分类</span></span><br><span class="line">chart.set_categories(cats)</span><br><span class="line">chart.shape = <span class="number">4</span></span><br><span class="line"><span class="comment"># 将图表添加到表单指定的单元格中</span></span><br><span class="line">sheet.add_chart(chart, <span class="string">&#x27;A10&#x27;</span>)</span><br><span class="line"></span><br><span class="line">wb.save(<span class="string">&#x27;demo.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>运行上面的代码，打开生成的Excel文件，效果如下图所示。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210819235009.png" alt="image-20210819235009026" width="75%">

<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>掌握了Python程序操作Excel的方法，可以解决日常办公中很多繁琐的处理Excel电子表格工作，最常见就是将多个数据格式相同的Excel文件合并到一个文件以及从多个Excel文件或表单中提取指定的数据。如果数据体量较大或者处理数据的方式比较复杂，我们还是推荐大家使用Python数据分析神器之一的<code>pandas</code>库。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第25课：用Python读写Excel文件-2/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC24%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E8%AF%BB%E5%86%99Excel%E6%96%87%E4%BB%B6-1/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.299Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第24课：用Python读写Excel文件-1Excel简介Excel是Microsoft（微软）为使用Windows和macOS操作系统开发的一款电子表格软件。Excel凭借其直观的界面、出色的计算功能和图表工具，再加上成功的市场营销，一直以来都是最为流行的个人计算机数据处理软件。当然，Excel也有很多竞品，例如Google Sheets、LibreOffice Calc、Numbers等，这些竞品基本上也能够兼容Excel，至少能够读写较新版本的Excel文件，当然这些不是我们讨论的重点。掌握用Python程序操作Excel文件，可以让日常办公自动化的工作更加轻松愉快，而且在很多商业项目中，导入导出Excel文件都是特别常见的功能。
Python操作Excel需要三方库的支持，如果要兼容Excel 2007以前的版本，也就是xls格式的Excel文件，可以使用三方库xlrd和xlwt，前者用于读Excel文件，后者用于写Excel文件。如果使用较新版本的Excel，即操作xlsx格式的Excel文件，可以使用openpyxl库，当然这个库不仅仅可以操作Excel，还可以操作其他基 -->
        <!-- </div> -->

        
        <h2 id="第24课：用Python读写Excel文件-1"><a href="#第24课：用Python读写Excel文件-1" class="headerlink" title="第24课：用Python读写Excel文件-1"></a>第24课：用Python读写Excel文件-1</h2><h3 id="Excel简介"><a href="#Excel简介" class="headerlink" title="Excel简介"></a>Excel简介</h3><p>Excel是Microsoft（微软）为使用Windows和macOS操作系统开发的一款电子表格软件。Excel凭借其直观的界面、出色的计算功能和图表工具，再加上成功的市场营销，一直以来都是最为流行的个人计算机数据处理软件。当然，Excel也有很多竞品，例如Google Sheets、LibreOffice Calc、Numbers等，这些竞品基本上也能够兼容Excel，至少能够读写较新版本的Excel文件，当然这些不是我们讨论的重点。掌握用Python程序操作Excel文件，可以让日常办公自动化的工作更加轻松愉快，而且在很多商业项目中，导入导出Excel文件都是特别常见的功能。</p>
<p>Python操作Excel需要三方库的支持，如果要兼容Excel 2007以前的版本，也就是<code>xls</code>格式的Excel文件，可以使用三方库<code>xlrd</code>和<code>xlwt</code>，前者用于读Excel文件，后者用于写Excel文件。如果使用较新版本的Excel，即操作<code>xlsx</code>格式的Excel文件，可以使用<code>openpyxl</code>库，当然这个库不仅仅可以操作Excel，还可以操作其他基于Office Open XML的电子表格文件。</p>
<p>本章我们先讲解基于<code>xlwt</code>和<code>xlrd</code>操作Excel文件，大家可以先使用下面的命令安装这两个三方库以及配合使用的工具模块<code>xlutils</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install xlwt xlrd xlutils</span><br></pre></td></tr></table></figure>

<h3 id="读Excel文件"><a href="#读Excel文件" class="headerlink" title="读Excel文件"></a>读Excel文件</h3><p>例如在当前文件夹下有一个名为“阿里巴巴2020年股票数据.xls”的Excel文件，如果想读取并显示该文件的内容，可以通过如下所示的代码来完成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用xlrd模块的open_workbook函数打开指定Excel文件并获得Book对象（工作簿）</span></span><br><span class="line">wb = xlrd.open_workbook(<span class="string">&#x27;阿里巴巴2020年股票数据.xls&#x27;</span>)</span><br><span class="line"><span class="comment"># 通过Book对象的sheet_names方法可以获取所有表单名称</span></span><br><span class="line">sheetnames = wb.sheet_names()</span><br><span class="line"><span class="built_in">print</span>(sheetnames)</span><br><span class="line"><span class="comment"># 通过指定的表单名称获取Sheet对象（工作表）</span></span><br><span class="line">sheet = wb.sheet_by_name(sheetnames[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># 通过Sheet对象的nrows和ncols属性获取表单的行数和列数</span></span><br><span class="line"><span class="built_in">print</span>(sheet.nrows, sheet.ncols)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(sheet.nrows):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(sheet.ncols):</span><br><span class="line">        <span class="comment"># 通过Sheet对象的cell方法获取指定Cell对象（单元格）</span></span><br><span class="line">        <span class="comment"># 通过Cell对象的value属性获取单元格中的值</span></span><br><span class="line">        value = sheet.cell(row, col).value</span><br><span class="line">        <span class="comment"># 对除首行外的其他行进行数据格式化处理</span></span><br><span class="line">        <span class="keyword">if</span> row &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 第1列的xldate类型先转成元组再格式化为“年月日”的格式</span></span><br><span class="line">            <span class="keyword">if</span> col == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># xldate_as_tuple函数的第二个参数只有0和1两个取值</span></span><br><span class="line">                <span class="comment"># 其中0代表以1900-01-01为基准的日期，1代表以1904-01-01为基准的日期</span></span><br><span class="line">                value = xlrd.xldate_as_tuple(value, <span class="number">0</span>)</span><br><span class="line">                value = <span class="string">f&#x27;<span class="subst">&#123;value[<span class="number">0</span>]&#125;</span>年<span class="subst">&#123;value[<span class="number">1</span>]:&gt;02d&#125;</span>月<span class="subst">&#123;value[<span class="number">2</span>]:&gt;02d&#125;</span>日&#x27;</span></span><br><span class="line">            <span class="comment"># 其他列的number类型处理成小数点后保留两位有效数字的浮点数</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                value = <span class="string">f&#x27;<span class="subst">&#123;value:<span class="number">.2</span>f&#125;</span>&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(value, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="comment"># 获取最后一个单元格的数据类型</span></span><br><span class="line"><span class="comment"># 0 - 空值，1 - 字符串，2 - 数字，3 - 日期，4 - 布尔，5 - 错误</span></span><br><span class="line">last_cell_type = sheet.cell_type(sheet.nrows - <span class="number">1</span>, sheet.ncols - <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(last_cell_type)</span><br><span class="line"><span class="comment"># 获取第一行的值（列表）</span></span><br><span class="line"><span class="built_in">print</span>(sheet.row_values(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># 获取指定行指定列范围的数据（列表）</span></span><br><span class="line"><span class="comment"># 第一个参数代表行索引，第二个和第三个参数代表列的开始（含）和结束（不含）索引</span></span><br><span class="line"><span class="built_in">print</span>(sheet.row_slice(<span class="number">3</span>, <span class="number">0</span>, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提示</strong>：上面代码中使用的Excel文件“阿里巴巴2020年股票数据.xls”可以通过后面的百度云盘地址进行获取。链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</a> 提取码:e7b4。</p>
</blockquote>
<p>相信通过上面的代码，大家已经了解到了如何读取一个Excel文件，如果想知道更多关于<code>xlrd</code>模块的知识，可以阅读它的<a target="_blank" rel="noopener" href="https://xlrd.readthedocs.io/en/latest/">官方文档</a>。</p>
<h3 id="写Excel文件"><a href="#写Excel文件" class="headerlink" title="写Excel文件"></a>写Excel文件</h3><p>写入Excel文件可以通过<code>xlwt</code> 模块的<code>Workbook</code>类创建工作簿对象，通过工作簿对象的<code>add_sheet</code>方法可以添加工作表，通过工作表对象的<code>write</code>方法可以向指定单元格中写入数据，最后通过工作簿对象的<code>save</code>方法将工作簿写入到指定的文件或内存中。下面的代码实现了将<code>5</code>个学生<code>3</code>门课程的考试成绩写入Excel文件的操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line"></span><br><span class="line">student_names = [<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;赵云&#x27;</span>, <span class="string">&#x27;马超&#x27;</span>, <span class="string">&#x27;黄忠&#x27;</span>]</span><br><span class="line">scores = [[random.randrange(<span class="number">50</span>, <span class="number">101</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="comment"># 创建工作簿对象（Workbook）</span></span><br><span class="line">wb = xlwt.Workbook()</span><br><span class="line"><span class="comment"># 创建工作表对象（Worksheet）</span></span><br><span class="line">sheet = wb.add_sheet(<span class="string">&#x27;一年级二班&#x27;</span>)</span><br><span class="line"><span class="comment"># 添加表头数据</span></span><br><span class="line">titles = (<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> index, title <span class="keyword">in</span> <span class="built_in">enumerate</span>(titles):</span><br><span class="line">    sheet.write(<span class="number">0</span>, index, title)</span><br><span class="line"><span class="comment"># 将学生姓名和考试成绩写入单元格</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(scores)):</span><br><span class="line">    sheet.write(row + <span class="number">1</span>, <span class="number">0</span>, student_names[row])</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(scores[row])):</span><br><span class="line">        sheet.write(row + <span class="number">1</span>, col + <span class="number">1</span>, scores[row][col])</span><br><span class="line"><span class="comment"># 保存Excel工作簿</span></span><br><span class="line">wb.save(<span class="string">&#x27;考试成绩表.xls&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="调整单元格样式"><a href="#调整单元格样式" class="headerlink" title="调整单元格样式"></a>调整单元格样式</h4><p>在写Excel文件时，我们还可以为单元格设置样式，主要包括字体（Font）、对齐方式（Alignment）、边框（Border）和背景（Background）的设置，<code>xlwt</code>对这几项设置都封装了对应的类来支持。要设置单元格样式需要首先创建一个<code>XFStyle</code>对象，再通过该对象的属性对字体、对齐方式、边框等进行设定，例如在上面的例子中，如果希望将表头单元格的背景色修改为黄色，可以按照如下的方式进行操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">header_style = xlwt.XFStyle()</span><br><span class="line">pattern = xlwt.Pattern()</span><br><span class="line">pattern.pattern = xlwt.Pattern.SOLID_PATTERN</span><br><span class="line"><span class="comment"># 0 - 黑色、1 - 白色、2 - 红色、3 - 绿色、4 - 蓝色、5 - 黄色、6 - 粉色、7 - 青色</span></span><br><span class="line">pattern.pattern_fore_colour = <span class="number">5</span></span><br><span class="line">header_style.pattern = pattern</span><br><span class="line">titles = (<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> index, title <span class="keyword">in</span> <span class="built_in">enumerate</span>(titles):</span><br><span class="line">    sheet.write(<span class="number">0</span>, index, title, header_style)</span><br></pre></td></tr></table></figure>

<p>如果希望为表头设置指定的字体，可以使用<code>Font</code>类并添加如下所示的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">font = xlwt.Font()</span><br><span class="line"><span class="comment"># 字体名称</span></span><br><span class="line">font.name = <span class="string">&#x27;华文楷体&#x27;</span></span><br><span class="line"><span class="comment"># 字体大小（20是基准单位，18表示18px）</span></span><br><span class="line">font.height = <span class="number">20</span> * <span class="number">18</span></span><br><span class="line"><span class="comment"># 是否使用粗体</span></span><br><span class="line">font.bold = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 是否使用斜体</span></span><br><span class="line">font.italic = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 字体颜色</span></span><br><span class="line">font.colour_index = <span class="number">1</span></span><br><span class="line">header_style.font = font</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：上面代码中指定的字体名（<code>font.name</code>）应当是本地系统有的字体，例如在我的电脑上有名为“华文楷体”的字体。</p>
</blockquote>
<p>如果希望表头垂直居中对齐，可以使用下面的代码进行设置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">align = xlwt.Alignment()</span><br><span class="line"><span class="comment"># 垂直方向的对齐方式</span></span><br><span class="line">align.vert = xlwt.Alignment.VERT_CENTER</span><br><span class="line"><span class="comment"># 水平方向的对齐方式</span></span><br><span class="line">align.horz = xlwt.Alignment.HORZ_CENTER</span><br><span class="line">header_style.alignment = align</span><br></pre></td></tr></table></figure>

<p>如果希望给表头加上黄色的虚线边框，可以使用下面的代码来设置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">borders = xlwt.Borders()</span><br><span class="line">props = (</span><br><span class="line">    (<span class="string">&#x27;top&#x27;</span>, <span class="string">&#x27;top_colour&#x27;</span>), (<span class="string">&#x27;right&#x27;</span>, <span class="string">&#x27;right_colour&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;bottom&#x27;</span>, <span class="string">&#x27;bottom_colour&#x27;</span>), (<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;left_colour&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 通过循环对四个方向的边框样式及颜色进行设定</span></span><br><span class="line"><span class="keyword">for</span> position, color <span class="keyword">in</span> props:</span><br><span class="line">    <span class="comment"># 使用setattr内置函数动态给对象指定的属性赋值</span></span><br><span class="line">    <span class="built_in">setattr</span>(borders, position, xlwt.Borders.DASHED)</span><br><span class="line">    <span class="built_in">setattr</span>(borders, color, <span class="number">5</span>)</span><br><span class="line">header_style.borders = borders</span><br></pre></td></tr></table></figure>

<p>如果要调整单元格的宽度（列宽）和表头的高度（行高），可以按照下面的代码进行操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置行高为40px</span></span><br><span class="line">sheet.row(<span class="number">0</span>).set_style(xlwt.easyxf(<span class="string">f&#x27;font:height <span class="subst">&#123;<span class="number">20</span> * <span class="number">40</span>&#125;</span>&#x27;</span>))</span><br><span class="line">titles = (<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> index, title <span class="keyword">in</span> <span class="built_in">enumerate</span>(titles):</span><br><span class="line">    <span class="comment"># 设置列宽为200px</span></span><br><span class="line">    sheet.col(index).width = <span class="number">20</span> * <span class="number">200</span></span><br><span class="line">    <span class="comment"># 设置单元格的数据和样式</span></span><br><span class="line">    sheet.write(<span class="number">0</span>, index, title, header_style)</span><br></pre></td></tr></table></figure>

<h4 id="公式计算"><a href="#公式计算" class="headerlink" title="公式计算"></a>公式计算</h4><p>对于前面打开的“阿里巴巴2020年股票数据.xls”文件，如果要统计全年收盘价（Close字段）的平均值以及全年交易量（Volume字段）的总和，可以使用Excel的公式计算即可。我们可以先使用<code>xlrd</code>读取Excel文件夹，然后通过<code>xlutils</code>三方库提供的<code>copy</code>函数将读取到的Excel文件转成<code>Workbook</code>对象进行写操作，在调用<code>write</code>方法时，可以将一个<code>Formula</code>对象写入单元格。</p>
<p>实现公式计算的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line"><span class="keyword">from</span> xlutils.copy <span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">wb_for_read = xlrd.open_workbook(<span class="string">&#x27;阿里巴巴2020年股票数据.xls&#x27;</span>)</span><br><span class="line">sheet1 = wb_for_read.sheet_by_index(<span class="number">0</span>)</span><br><span class="line">nrows, ncols = sheet1.nrows, sheet1.ncols</span><br><span class="line">wb_for_write = copy(wb_for_read)</span><br><span class="line">sheet2 = wb_for_write.get_sheet(<span class="number">0</span>)</span><br><span class="line">sheet2.write(nrows, <span class="number">4</span>, xlwt.Formula(<span class="string">f&#x27;average(E2:E<span class="subst">&#123;nrows&#125;</span>)&#x27;</span>))</span><br><span class="line">sheet2.write(nrows, <span class="number">6</span>, xlwt.Formula(<span class="string">f&#x27;sum(G2:G<span class="subst">&#123;nrows&#125;</span>)&#x27;</span>))</span><br><span class="line">wb_for_write.save(<span class="string">&#x27;阿里巴巴2020年股票数据汇总.xls&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明</strong>：上面的代码有一些小瑕疵，有兴趣的读者可以自行探索并思考如何解决。</p>
</blockquote>
<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>掌握了Python程序操作Excel的方法，可以解决日常办公中很多繁琐的处理Excel电子表格工作，最常见就是将多个数据格式相同的Excel文件合并到一个文件以及从多个Excel文件或表单中提取指定的数据。当然，如果要对表格数据进行处理，使用Python数据分析神器之一的<code>pandas</code>库可能更为方便。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第24课：用Python读写Excel文件-1/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC23%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E8%AF%BB%E5%86%99CSV%E6%96%87%E4%BB%B6/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.291Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第23课：用Python读写CSV文件CSV文件介绍CSV（Comma Separated Values）全称逗号分隔值文件是一种简单、通用的文件格式，被广泛的应用于应用程序（数据库、电子表格等）数据的导入和导出以及异构系统之间的数据交换。因为CSV是纯文本文件，不管是什么操作系统和编程语言都是可以处理纯文本的，而且很多编程语言中都提供了对读写CSV文件的支持，因此CSV格式在数据处理和数据科学中被广泛应用。
CSV文件有以下特点：

纯文本，使用某种字符集（如ASCII、Unicode、GB2312）等）；
由一条条的记录组成（典型的是每行一条记录）；
每条记录被分隔符（如逗号、分号、制表符等）分隔为字段（列）；
每条记录都有同样的字段序列。

CSV文件可以使用文本编辑器或类似于Excel电子表格这类工具打开和编辑，当使用Excel这类电子表格打开CSV文件时，你甚至感觉不到CSV和Excel文件的区别。很多数据库系统都支持将数据导出到CSV文件中，当然也支持从CSV文件中读入数据保存到数据库中，这些内容并不是现在要讨论的重点。
将数据写入CSV文件现有五个学生三门课程的考试成绩需 -->
        <!-- </div> -->

        
        <h2 id="第23课：用Python读写CSV文件"><a href="#第23课：用Python读写CSV文件" class="headerlink" title="第23课：用Python读写CSV文件"></a>第23课：用Python读写CSV文件</h2><h3 id="CSV文件介绍"><a href="#CSV文件介绍" class="headerlink" title="CSV文件介绍"></a>CSV文件介绍</h3><p>CSV（Comma Separated Values）全称逗号分隔值文件是一种简单、通用的文件格式，被广泛的应用于应用程序（数据库、电子表格等）数据的导入和导出以及异构系统之间的数据交换。因为CSV是纯文本文件，不管是什么操作系统和编程语言都是可以处理纯文本的，而且很多编程语言中都提供了对读写CSV文件的支持，因此CSV格式在数据处理和数据科学中被广泛应用。</p>
<p>CSV文件有以下特点：</p>
<ol>
<li>纯文本，使用某种字符集（如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ASCII">ASCII</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Unicode">Unicode</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GB2312">GB2312</a>）等）；</li>
<li>由一条条的记录组成（典型的是每行一条记录）；</li>
<li>每条记录被分隔符（如逗号、分号、制表符等）分隔为字段（列）；</li>
<li>每条记录都有同样的字段序列。</li>
</ol>
<p>CSV文件可以使用文本编辑器或类似于Excel电子表格这类工具打开和编辑，当使用Excel这类电子表格打开CSV文件时，你甚至感觉不到CSV和Excel文件的区别。很多数据库系统都支持将数据导出到CSV文件中，当然也支持从CSV文件中读入数据保存到数据库中，这些内容并不是现在要讨论的重点。</p>
<h3 id="将数据写入CSV文件"><a href="#将数据写入CSV文件" class="headerlink" title="将数据写入CSV文件"></a>将数据写入CSV文件</h3><p>现有五个学生三门课程的考试成绩需要保存到一个CSV文件中，要达成这个目标，可以使用Python标准库中的<code>csv</code>模块，该模块的<code>writer</code>函数会返回一个<code>csvwriter</code>对象，通过该对象的<code>writerow</code>或<code>writerows</code>方法就可以将数据写入到CSV文件中，具体的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;scores.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer = csv.writer(file)</span><br><span class="line">    writer.writerow([<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>])</span><br><span class="line">    names = [<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;赵云&#x27;</span>, <span class="string">&#x27;马超&#x27;</span>, <span class="string">&#x27;黄忠&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        scores = [random.randrange(<span class="number">50</span>, <span class="number">101</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">        scores.insert(<span class="number">0</span>, name)</span><br><span class="line">        writer.writerow(scores)</span><br></pre></td></tr></table></figure>

<p>生成的CSV文件的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">姓名,语文,数学,英语</span><br><span class="line">关羽,98,86,61</span><br><span class="line">张飞,86,58,80</span><br><span class="line">赵云,95,73,70</span><br><span class="line">马超,83,97,55</span><br><span class="line">黄忠,61,54,87</span><br></pre></td></tr></table></figure>

<p>需要说明的是上面的<code>writer</code>函数，除了传入要写入数据的文件对象外，还可以<code>dialect</code>参数，它表示CSV文件的方言，默认值是<code>excel</code>。除此之外，还可以通过<code>delimiter</code>、<code>quotechar</code>、<code>quoting</code>参数来指定分隔符（默认是逗号）、包围值的字符（默认是双引号）以及包围的方式。其中，包围值的字符主要用于当字段中有特殊符号时，通过添加包围值的字符可以避免二义性。大家可以尝试将上面第5行代码修改为下面的代码，然后查看生成的CSV文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writer = csv.writer(file, delimiter=<span class="string">&#x27;|&#x27;</span>, quoting=csv.QUOTE_ALL)</span><br></pre></td></tr></table></figure>

<p>生成的CSV文件的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;姓名&quot;|&quot;语文&quot;|&quot;数学&quot;|&quot;英语&quot;</span><br><span class="line">&quot;关羽&quot;|&quot;88&quot;|&quot;64&quot;|&quot;65&quot;</span><br><span class="line">&quot;张飞&quot;|&quot;76&quot;|&quot;93&quot;|&quot;79&quot;</span><br><span class="line">&quot;赵云&quot;|&quot;78&quot;|&quot;55&quot;|&quot;76&quot;</span><br><span class="line">&quot;马超&quot;|&quot;72&quot;|&quot;77&quot;|&quot;68&quot;</span><br><span class="line">&quot;黄忠&quot;|&quot;70&quot;|&quot;72&quot;|&quot;51&quot;</span><br></pre></td></tr></table></figure>

<h3 id="从CSV文件读取数据"><a href="#从CSV文件读取数据" class="headerlink" title="从CSV文件读取数据"></a>从CSV文件读取数据</h3><p>如果要读取刚才创建的CSV文件，可以使用下面的代码，通过<code>csv</code>模块的<code>reader</code>函数可以创建出<code>csvreader</code>对象，该对象是一个迭代器，可以通过<code>next</code>函数或<code>for-in</code>循环读取到文件中的数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;scores.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    reader = csv.reader(file, delimiter=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> data_list <span class="keyword">in</span> reader:</span><br><span class="line">        <span class="built_in">print</span>(reader.line_num, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> data_list:</span><br><span class="line">            <span class="built_in">print</span>(elem, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：上面的代码对<code>csvreader</code>对象做<code>for</code>循环时，每次会取出一个列表对象，该列表对象包含了一行中所有的字段。</p>
</blockquote>
<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>将来如果大家使用Python做数据分析，很有可能会用到名为<code>pandas</code>的三方库，它是Python数据分析的神器之一。<code>pandas</code>中封装了名为<code>read_csv</code>和<code>to_csv</code>的函数用来读写CSV文件，其中<code>read_CSV</code>会将读取到的数据变成一个<code>DataFrame</code>对象，而<code>DataFrame</code>就是<code>pandas</code>库中最重要的类型，它封装了一系列用于数据处理的方法（清洗、转换、聚合等）；而<code>to_csv</code>会将<code>DataFrame</code>对象中的数据写入CSV文件，完成数据的持久化。<code>read_csv</code>函数和<code>to_csv</code>函数远远比原生的<code>csvreader</code>和<code>csvwriter</code>强大。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第23课：用Python读写CSV文件/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC21%E8%AF%BE%EF%BC%9A%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E5%92%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.276Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第21课：文件读写和异常处理实际开发中常常会遇到对数据进行持久化的场景，所谓持久化是指将数据从无法长久保存数据的存储介质（通常是内存）转移到可以长久保存数据的存储介质（通常是硬盘）中。实现数据持久化最直接简单的方式就是通过文件系统将数据保存到文件中。
计算机的文件系统是一种存储和组织计算机数据的方法，它使得对数据的访问和查找变得容易，文件系统使用文件和树形目录的抽象逻辑概念代替了硬盘、光盘、闪存等物理设备的数据块概念，用户使用文件系统来保存数据时，不必关心数据实际保存在硬盘的哪个数据块上，只需要记住这个文件的路径和文件名。在写入新数据之前，用户不必关心硬盘上的哪个数据块没有被使用，硬盘上的存储空间管理（分配和释放）功能由文件系统自动完成，用户只需要记住数据被写入到了哪个文件中。
打开和关闭文件有了文件系统，我们可以非常方便的通过文件来读写数据；在Python中要实现文件操作是非常简单的。我们可以使用Python内置的open函数来打开文件，在使用open函数时，我们可以通过函数的参数指定文件名、操作模式和字符编码等信息，接下来就可以对文件进行读写操作了。这里所说的操作模式是指要打开什么 -->
        <!-- </div> -->

        
        <h2 id="第21课：文件读写和异常处理"><a href="#第21课：文件读写和异常处理" class="headerlink" title="第21课：文件读写和异常处理"></a>第21课：文件读写和异常处理</h2><p>实际开发中常常会遇到对数据进行持久化的场景，所谓持久化是指将数据从无法长久保存数据的存储介质（通常是内存）转移到可以长久保存数据的存储介质（通常是硬盘）中。实现数据持久化最直接简单的方式就是通过<strong>文件系统</strong>将数据保存到<strong>文件</strong>中。</p>
<p>计算机的<strong>文件系统</strong>是一种存储和组织计算机数据的方法，它使得对数据的访问和查找变得容易，文件系统使用<strong>文件</strong>和<strong>树形目录</strong>的抽象逻辑概念代替了硬盘、光盘、闪存等物理设备的数据块概念，用户使用文件系统来保存数据时，不必关心数据实际保存在硬盘的哪个数据块上，只需要记住这个文件的路径和文件名。在写入新数据之前，用户不必关心硬盘上的哪个数据块没有被使用，硬盘上的存储空间管理（分配和释放）功能由文件系统自动完成，用户只需要记住数据被写入到了哪个文件中。</p>
<h3 id="打开和关闭文件"><a href="#打开和关闭文件" class="headerlink" title="打开和关闭文件"></a>打开和关闭文件</h3><p>有了文件系统，我们可以非常方便的通过文件来读写数据；在Python中要实现文件操作是非常简单的。我们可以使用Python内置的<code>open</code>函数来打开文件，在使用<code>open</code>函数时，我们可以通过函数的参数指定<strong>文件名</strong>、<strong>操作模式</strong>和<strong>字符编码</strong>等信息，接下来就可以对文件进行读写操作了。这里所说的操作模式是指要打开什么样的文件（字符文件或二进制文件）以及做什么样的操作（读、写或追加），具体如下表所示。</p>
<table>
<thead>
<tr>
<th>操作模式</th>
<th>具体含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#39;r&#39;</code></td>
<td>读取 （默认）</td>
</tr>
<tr>
<td><code>&#39;w&#39;</code></td>
<td>写入（会先截断之前的内容）</td>
</tr>
<tr>
<td><code>&#39;x&#39;</code></td>
<td>写入，如果文件已经存在会产生异常</td>
</tr>
<tr>
<td><code>&#39;a&#39;</code></td>
<td>追加，将内容写入到已有文件的末尾</td>
</tr>
<tr>
<td><code>&#39;b&#39;</code></td>
<td>二进制模式</td>
</tr>
<tr>
<td><code>&#39;t&#39;</code></td>
<td>文本模式（默认）</td>
</tr>
<tr>
<td><code>&#39;+&#39;</code></td>
<td>更新（既可以读又可以写）</td>
</tr>
</tbody></table>
<p>下图展示了如何根据程序的需要来设置<code>open</code>函数的操作模式。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20210803201644.png" width="75%">

<p>在使用<code>open</code>函数时，如果打开的文件是字符文件（文本文件），可以通过<code>encoding</code>参数来指定读写文件使用的字符编码。如果对字符编码和字符集这些概念不了解，可以看看<a target="_blank" rel="noopener" href="https://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html">《字符集和字符编码》</a>一文，此处不再进行赘述。</p>
<p>使用<code>open</code>函数打开文件成功后会返回一个文件对象，通过这个对象，我们就可以实现对文件的读写操作；如果打开文件失败，<code>open</code>函数会引发异常，稍后会对此加以说明。如果要关闭打开的文件，可以使用文件对象的<code>close</code>方法，这样可以在结束文件操作时释放掉这个文件。</p>
<h3 id="读写文本文件"><a href="#读写文本文件" class="headerlink" title="读写文本文件"></a>读写文本文件</h3><p>用<code>open</code>函数打开文本文件时，需要指定文件名并将文件的操作模式设置为<code>&#39;r&#39;</code>，如果不指定，默认值也是<code>&#39;r&#39;</code>；如果需要指定字符编码，可以传入<code>encoding</code>参数，如果不指定，默认值是None，那么在读取文件时使用的是操作系统默认的编码。需要提醒大家，如果不能保证保存文件时使用的编码方式与<code>encoding</code>参数指定的编码方式是一致的，那么就可能因无法解码字符而导致读取文件失败。</p>
<p>下面的例子演示了如何读取一个纯文本文件（一般指只有字符原生编码构成的文件，与富文本相比，纯文本不包含字符样式的控制元素，能够被最简单的文本编辑器直接读取）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(file.read())</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明</strong>：<a target="_blank" rel="noopener" href="http://www.china.org.cn/learning_english/2011-02/21/content_21967654.htm">《致橡树》</a>是舒婷老师在1977年3月创建的爱情诗，也是我最喜欢的现代诗之一。</p>
</blockquote>
<p>除了使用文件对象的<code>read</code>方法读取文件之外，还可以使用<code>for-in</code>循环逐行读取或者用<code>readlines</code>方法将文件按行读取到一个列表容器中，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">    <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">file.close()</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">lines = file.readlines()</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<p>如果要向文件中写入内容，可以在打开文件时使用<code>w</code>或者<code>a</code>作为操作模式，前者会截断之前的文本内容写入新的内容，后者是在原来内容的尾部追加新的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">file.write(<span class="string">&#x27;\n标题：《致橡树》&#x27;</span>)</span><br><span class="line">file.write(<span class="string">&#x27;\n作者：舒婷&#x27;</span>)</span><br><span class="line">file.write(<span class="string">&#x27;\n时间：1977年3月&#x27;</span>)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<h3 id="异常处理机制"><a href="#异常处理机制" class="headerlink" title="异常处理机制"></a>异常处理机制</h3><p>请注意上面的代码，如果<code>open</code>函数指定的文件并不存在或者无法打开，那么将引发异常状况导致程序崩溃。为了让代码具有健壮性和容错性，我们可以<strong>使用Python的异常机制对可能在运行时发生状况的代码进行适当的处理</strong>。Python中和异常相关的关键字有五个，分别是<code>try</code>、<code>except</code>、<code>else</code>、<code>finally</code>和<code>raise</code>，我们先看看下面的代码，再来为大家介绍这些关键字的用法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(file.read())</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;无法打开指定的文件!&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> LookupError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;指定了未知的编码!&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;读取文件时解码错误!&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> file:</span><br><span class="line">        file.close()</span><br></pre></td></tr></table></figure>

<p>在Python中，我们可以将运行时会出现状况的代码放在<code>try</code>代码块中，在<code>try</code>后面可以跟上一个或多个<code>except</code>块来捕获异常并进行相应的处理。例如，在上面的代码中，文件找不到会引发<code>FileNotFoundError</code>，指定了未知的编码会引发<code>LookupError</code>，而如果读取文件时无法按指定编码方式解码文件会引发<code>UnicodeDecodeError</code>，所以我们在<code>try</code>后面跟上了三个<code>except</code>分别处理这三种不同的异常状况。在<code>except</code>后面，我们还可以加上<code>else</code>代码块，这是<code>try</code> 中的代码没有出现异常时会执行的代码，而且<code>else</code>中的代码不会再进行异常捕获，也就是说如果遇到异常状况，程序会因异常而终止并报告异常信息。最后我们使用<code>finally</code>代码块来关闭打开的文件，释放掉程序中获取的外部资源。由于<code>finally</code>块的代码不论程序正常还是异常都会执行，甚至是调用了<code>sys</code>模块的<code>exit</code>函数终止Python程序，<code>finally</code>块中的代码仍然会被执行（因为<code>exit</code>函数的本质是引发了<code>SystemExit</code>异常），因此我们把<code>finally</code>代码块称为“总是执行代码块”，它最适合用来做释放外部资源的操作。</p>
<p>Python中内置了大量的异常类型，除了上面代码中用到的异常类型以及之前的课程中遇到过的异常类型外，还有许多的异常类型，其继承结构如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- SystemExit</span><br><span class="line"> +-- KeyboardInterrupt</span><br><span class="line"> +-- GeneratorExit</span><br><span class="line"> +-- Exception</span><br><span class="line">      +-- StopIteration</span><br><span class="line">      +-- StopAsyncIteration</span><br><span class="line">      +-- ArithmeticError</span><br><span class="line">      |    +-- FloatingPointError</span><br><span class="line">      |    +-- OverflowError</span><br><span class="line">      |    +-- ZeroDivisionError</span><br><span class="line">      +-- AssertionError</span><br><span class="line">      +-- AttributeError</span><br><span class="line">      +-- BufferError</span><br><span class="line">      +-- EOFError</span><br><span class="line">      +-- ImportError</span><br><span class="line">      |    +-- ModuleNotFoundError</span><br><span class="line">      +-- LookupError</span><br><span class="line">      |    +-- IndexError</span><br><span class="line">      |    +-- KeyError</span><br><span class="line">      +-- MemoryError</span><br><span class="line">      +-- NameError</span><br><span class="line">      |    +-- UnboundLocalError</span><br><span class="line">      +-- OSError</span><br><span class="line">      |    +-- BlockingIOError</span><br><span class="line">      |    +-- ChildProcessError</span><br><span class="line">      |    +-- ConnectionError</span><br><span class="line">      |    |    +-- BrokenPipeError</span><br><span class="line">      |    |    +-- ConnectionAbortedError</span><br><span class="line">      |    |    +-- ConnectionRefusedError</span><br><span class="line">      |    |    +-- ConnectionResetError</span><br><span class="line">      |    +-- FileExistsError</span><br><span class="line">      |    +-- FileNotFoundError</span><br><span class="line">      |    +-- InterruptedError</span><br><span class="line">      |    +-- IsADirectoryError</span><br><span class="line">      |    +-- NotADirectoryError</span><br><span class="line">      |    +-- PermissionError</span><br><span class="line">      |    +-- ProcessLookupError</span><br><span class="line">      |    +-- TimeoutError</span><br><span class="line">      +-- ReferenceError</span><br><span class="line">      +-- RuntimeError</span><br><span class="line">      |    +-- NotImplementedError</span><br><span class="line">      |    +-- RecursionError</span><br><span class="line">      +-- SyntaxError</span><br><span class="line">      |    +-- IndentationError</span><br><span class="line">      |         +-- TabError</span><br><span class="line">      +-- SystemError</span><br><span class="line">      +-- TypeError</span><br><span class="line">      +-- ValueError</span><br><span class="line">      |    +-- UnicodeError</span><br><span class="line">      |         +-- UnicodeDecodeError</span><br><span class="line">      |         +-- UnicodeEncodeError</span><br><span class="line">      |         +-- UnicodeTranslateError</span><br><span class="line">      +-- Warning</span><br><span class="line">           +-- DeprecationWarning</span><br><span class="line">           +-- PendingDeprecationWarning</span><br><span class="line">           +-- RuntimeWarning</span><br><span class="line">           +-- SyntaxWarning</span><br><span class="line">           +-- UserWarning</span><br><span class="line">           +-- FutureWarning</span><br><span class="line">           +-- ImportWarning</span><br><span class="line">           +-- UnicodeWarning</span><br><span class="line">           +-- BytesWarning</span><br><span class="line">           +-- ResourceWarning</span><br></pre></td></tr></table></figure>

<p>从上面的继承结构可以看出，Python中所有的异常都是<code>BaseException</code>的子类型，它有四个直接的子类，分别是：<code>SystemExit</code>、<code>KeyboardInterrupt</code>、<code>GeneratorExit</code>和<code>Exception</code>。其中，<code>SystemExit</code>表示解释器请求退出，<code>KeyboardInterrupt</code>是用户中断程序执行（按下<code>Ctrl+c</code>），<code>GeneratorExit</code>表示生成器发生异常通知退出，不理解这些异常没有关系，继续学习就好了。值得一提的是<code>Exception</code>类，它是常规异常类型的父类型，很多的异常都是直接或间接的继承自<code>Exception</code>类。如果Python内置的异常类型不能满足应用程序的需要，我们可以自定义异常类型，而自定义的异常类型也应该直接或间接继承自<code>Exception</code>类，当然还可以根据需要重写或添加方法。</p>
<p>在Python中，可以使用<code>raise</code>关键字来引发异常（抛出异常对象），而调用者可以通过<code>try...except...</code>结构来捕获并处理异常。例如在函数中，当函数的执行条件不满足时，可以使用抛出异常的方式来告知调用者问题的所在，而调用者可以通过捕获处理异常来使得代码从异常中恢复，定义异常和抛出异常的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputError</span>(<span class="params">ValueError</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;自定义异常类型&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fac</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;求阶乘&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> num &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> InputError(<span class="string">&#x27;只能计算非负整数的阶乘&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num * fac(num - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>调用求阶乘的函数<code>fac</code>，通过<code>try...except...</code>结构捕获输入错误的异常并打印异常对象（显示异常信息），如果输入正确就计算阶乘并结束程序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="literal">True</span></span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;n = &#x27;</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;num&#125;</span>! = <span class="subst">&#123;fac(num)&#125;</span>&#x27;</span>)</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> InputError <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(err)</span><br></pre></td></tr></table></figure>

<h3 id="上下文语法"><a href="#上下文语法" class="headerlink" title="上下文语法"></a>上下文语法</h3><p>对于<code>open</code>函数返回的文件对象，还可以使用<code>with</code>上下文语法在文件操作完成后自动执行文件对象的<code>close</code>方法，这样可以让代码变得更加简单优雅，因为不需要再写<code>finally</code>代码块来执行关闭文件释放资源的操作。需要提醒大家的是，并不是所有的对象都可以放在<code>with</code>上下文语法中，只有符合<strong>上下文管理器协议</strong>（有<code>__enter__</code>和<code>__exit__</code>魔术方法）的对象才能使用这种语法，Python标准库中的<code>contextlib</code>模块也提供了对<code>with</code>上下文语法的支持，后面再为大家进行讲解。</p>
<p>用<code>with</code>上下文语法改写后的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;致橡树.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="built_in">print</span>(file.read())</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;无法打开指定的文件!&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> LookupError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;指定了未知的编码!&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;读取文件时解码错误!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="读写二进制文件"><a href="#读写二进制文件" class="headerlink" title="读写二进制文件"></a>读写二进制文件</h3><p>读写二进制文件跟读写文本文件的操作类似，但是需要注意，在使用<code>open</code>函数打开文件时，如果要进行读操作，操作模式是<code>&#39;rb&#39;</code>，如果要进行写操作，操作模式是<code>&#39;wb&#39;</code>。还有一点，读写文本文件时，<code>read</code>方法的返回值以及<code>write</code>方法的参数是<code>str</code>对象（字符串），而读写二进制文件时，<code>read</code>方法的返回值以及<code>write</code>方法的参数是<code>bytes-like</code>对象（字节串）。下面的代码实现了将当前路径下名为<code>guido.jpg</code>的图片文件复制到<code>吉多.jpg</code>文件中的操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file1:</span><br><span class="line">        data = file1.read()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;吉多.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file2:</span><br><span class="line">        file2.write(data)</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;指定的文件无法打开.&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> IOError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;读写文件时出现错误.&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;程序执行结束.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果要复制的图片文件很大，一次将文件内容直接读入内存中可能会造成非常大的内存开销，为了减少对内存的占用，可以为<code>read</code>方法传入<code>size</code>参数来指定每次读取的字节数，通过循环读取和写入的方式来完成上面的操作，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file1, <span class="built_in">open</span>(<span class="string">&#x27;吉多.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file2:</span><br><span class="line">        data = file1.read(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">while</span> data:</span><br><span class="line">            file2.write(data)</span><br><span class="line">            data = file1.read()</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;指定的文件无法打开.&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> IOError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;读写文件时出现错误.&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;程序执行结束.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>通过读写文件的操作，我们可以实现数据持久化。在Python中可以通过<code>open</code>函数来获得文件对象，可以通过文件对象的<code>read</code>和<code>write</code>方法实现文件读写操作。程序在运行时可能遭遇无法预料的异常状况，可以使用Python的异常机制来处理这些状况。Python的异常机制主要包括<code>try</code>、<code>except</code>、<code>else</code>、<code>finally</code>和<code>raise</code>这五个核心关键字。<code>try</code>后面的<code>except</code>语句不是必须的，<code>finally</code>语句也不是必须的，但是二者必须要有一个；<code>except</code>语句可以有一个或多个，多个<code>except</code>会按照书写的顺序依次匹配指定的异常，如果异常已经处理就不会再进入后续的<code>except</code>语句；<code>except</code>语句中还可以通过元组同时指定多个异常类型进行捕获；<code>except</code>语句后面如果不指定异常类型，则默认捕获所有异常；捕获异常后可以使用<code>raise</code>要再次抛出，但是不建议捕获并抛出同一个异常；不建议在不清楚逻辑的情况下捕获所有异常，这可能会掩盖程序中严重的问题。最后强调一点，<strong>不要使用异常机制来处理正常业务逻辑或控制程序流程</strong>，简单的说就是不要滥用异常机制，这是初学者常犯的错误。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第21课：文件读写和异常处理/"> Read more -->
          </span>
        </div>

        
    
    <div class="recent-post-item">

      <a href="/2021/09/12/%E7%AC%AC20%E8%AF%BE%EF%BC%9APython%E6%A0%87%E5%87%86%E5%BA%93%E5%88%9D%E6%8E%A2/" class="item-title"></a>
      
      <time datetime="2021-09-12T12:55:47.267Z">
        2021-09-12
      </time>
      
      <!-- <div class="article-digest"> -->
        <!-- 第20课：Python标准库初探Python语言最可爱的地方在于它的标准库和三方库实在是太丰富了，日常开发工作中的很多任务都可以通过这些标准库或者三方库直接解决。下面我们先介绍Python标准库中的一些常用模块，后面的课程中再陆陆续续为大家介绍Python常用三方库的用途和用法。
base64 - Base64编解码模块Base64是一种基于64个可打印字符来表示二进制数据的方法。由于$log _{2}64=6$，所以Base64以6个比特（二进制位，可以表示0或1）为一个单元，每个单元对应一个可打印字符。对于3字节（24比特）的二进制数据，我们可以将其处理成对应于4个Base64单元，即3个字节可由4个可打印字符来表示。Base64编码可用来作为电子邮件的传输编码，也可以用于其他需要将二进制数据转成文本字符的场景，这使得在XML、JSON、YAML这些文本数据格式中传输二进制内容成为可能。在Base64中的可打印字符包括A-Z、a-z、0-9，这里一共是62个字符，另外两个可打印符号通常是+和/，=用于在Base64编码最后进行补位。
关于Base64编码的细节，大家可以参考《Bas -->
        <!-- </div> -->

        
        <h2 id="第20课：Python标准库初探"><a href="#第20课：Python标准库初探" class="headerlink" title="第20课：Python标准库初探"></a>第20课：Python标准库初探</h2><p>Python语言最可爱的地方在于它的标准库和三方库实在是太丰富了，日常开发工作中的很多任务都可以通过这些标准库或者三方库直接解决。下面我们先介绍Python标准库中的一些常用模块，后面的课程中再陆陆续续为大家介绍Python常用三方库的用途和用法。</p>
<h3 id="base64-Base64编解码模块"><a href="#base64-Base64编解码模块" class="headerlink" title="base64 - Base64编解码模块"></a>base64 - Base64编解码模块</h3><p><strong>Base64</strong>是一种基于64个可打印字符来表示二进制数据的方法。由于$log _{2}64=6$，所以Base64以6个比特（二进制位，可以表示0或1）为一个单元，每个单元对应一个可打印字符。对于3字节（24比特）的二进制数据，我们可以将其处理成对应于4个Base64单元，即3个字节可由4个可打印字符来表示。Base64编码可用来作为电子邮件的传输编码，也可以用于其他需要将二进制数据转成文本字符的场景，这使得在XML、JSON、YAML这些文本数据格式中传输二进制内容成为可能。在Base64中的可打印字符包括<code>A-Z</code>、<code>a-z</code>、<code>0-9</code>，这里一共是62个字符，另外两个可打印符号通常是<code>+</code>和<code>/</code>，<code>=</code>用于在Base64编码最后进行补位。</p>
<p>关于Base64编码的细节，大家可以参考<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2008/06/base64.html">《Base64笔记》</a>一文，Python标准库中的<code>base64</code>模块提供了<code>b64encode</code>和<code>b64decode</code>两个函数，专门用于实现Base64的编码和解码，下面演示了在<strong>Python的交互式环境</strong>中执行这两个函数的效果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">&#x27;Man is distinguished, not only by his reason, but by this singular passion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure.&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(content.encode())</span><br><span class="line"><span class="string">b&#x27;TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlzIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLCB3aGljaCBpcyBhIGx1c3Qgb2YgdGhlIG1pbmQsIHRoYXQgYnkgYSBwZXJzZXZlcmFuY2Ugb2YgZGVsaWdodCBpbiB0aGUgY29udGludWVkIGFuZCBpbmRlZmF0aWdhYmxlIGdlbmVyYXRpb24gb2Yga25vd2xlZGdlLCBleGNlZWRzIHRoZSBzaG9ydCB2ZWhlbWVuY2Ugb2YgYW55IGNhcm5hbCBwbGVhc3VyZS4=&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">b&#x27;TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlzIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLCB3aGljaCBpcyBhIGx1c3Qgb2YgdGhlIG1pbmQsIHRoYXQgYnkgYSBwZXJzZXZlcmFuY2Ugb2YgZGVsaWdodCBpbiB0aGUgY29udGludWVkIGFuZCBpbmRlZmF0aWdhYmxlIGdlbmVyYXRpb24gb2Yga25vd2xlZGdlLCBleGNlZWRzIHRoZSBzaG9ydCB2ZWhlbWVuY2Ugb2YgYW55IGNhcm5hbCBwbGVhc3VyZS4=&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(content).decode()</span><br><span class="line"><span class="string">&#x27;Man is distinguished, not only by his reason, but by this singular passion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure.&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="collections-容器数据类型模块"><a href="#collections-容器数据类型模块" class="headerlink" title="collections - 容器数据类型模块"></a>collections - 容器数据类型模块</h3><p><code>collections</code>模块提供了诸多非常好用的数据结构，主要包括：</p>
<ul>
<li><code>namedtuple</code>：命令元组，它是一个类工厂，接受类型的名称和属性列表来创建一个类。</li>
<li><code>deque</code>：双端队列，是列表的替代实现。Python中的列表底层是基于数组来实现的，而<code>deque</code>底层是双向链表，因此当你需要在头尾添加和删除元素是，<code>deque</code>会表现出更好的性能，渐近时间复杂度为$O(1)$。</li>
<li><code>Counter</code>：<code>dict</code>的子类，键是元素，值是元素的计数，它的<code>most_common()</code>方法可以帮助我们获取出现频率最高的元素。<code>Counter</code>和<code>dict</code>的继承关系我认为是值得商榷的，按照CARP原则，<code>Counter</code>跟<code>dict</code>的关系应该设计为关联关系更为合理。</li>
<li><code>OrderedDict</code>：<code>dict</code>的子类，它记录了键值对插入的顺序，看起来既有字典的行为，也有链表的行为。</li>
<li><code>defaultdict</code>：类似于字典类型，但是可以通过默认的工厂函数来获得键对应的默认值，相比字典中的<code>setdefault()</code>方法，这种做法更加高效。</li>
</ul>
<p>下面是在<strong>Python交互式环境中</strong>使用<code>namedtuple</code>创建扑克牌类的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Card = namedtuple(<span class="string">&#x27;Card&#x27;</span>, (<span class="string">&#x27;suite&#x27;</span>, <span class="string">&#x27;face&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>card1 = Card(<span class="string">&#x27;红桃&#x27;</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>card2 = Card(<span class="string">&#x27;草花&#x27;</span>, <span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>card1</span><br><span class="line">Card(suite=<span class="string">&#x27;红桃&#x27;</span>, face=<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>card2</span><br><span class="line">Card(suite=<span class="string">&#x27;草花&#x27;</span>, face=<span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;card1.suite&#125;</span><span class="subst">&#123;card1.face&#125;</span>&#x27;</span>)</span><br><span class="line">红桃<span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;card2.suite&#125;</span><span class="subst">&#123;card2.face&#125;</span>&#x27;</span>)</span><br><span class="line">草花<span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>下面是使用<code>Counter</code>类统计列表中出现次数最多的三个元素的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">words = [</span><br><span class="line">    <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;around&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&quot;don&#x27;t&quot;</span>, <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;around&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&quot;you&#x27;re&quot;</span>, <span class="string">&#x27;under&#x27;</span></span><br><span class="line">]</span><br><span class="line">counter = Counter(words)</span><br><span class="line"><span class="comment"># 打印words列表中出现频率最高的3个元素及其出现次数</span></span><br><span class="line"><span class="keyword">for</span> elem, count <span class="keyword">in</span> counter.most_common(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(elem, count)</span><br></pre></td></tr></table></figure>

<h3 id="hashlib-哈希函数模块"><a href="#hashlib-哈希函数模块" class="headerlink" title="hashlib - 哈希函数模块"></a>hashlib - 哈希函数模块</h3><p>哈希函数又称哈希算法或散列函数，是一种为已有的数据创建“数字指纹”（哈希摘要）的方法。哈希函数把数据压缩成摘要，对于相同的输入，哈希函数可以生成相同的摘要（数字指纹），需要注意的是这个过程并不可逆（不能通过摘要计算出输入的内容）。一个优质的哈希函数能够为不同的输入生成不同的摘要，出现哈希冲突（不同的输入产生相同的摘要）的概率极低，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/MD5">MD5</a>、<a href="%5Bhttps://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F%5D(https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F)">SHA家族</a>就是这类好的哈希函数。</p>
<blockquote>
<p><strong>说明</strong>：在2011年的时候，RFC 6151中已经禁止将MD5用作密钥散列消息认证码，这个问题不在我们讨论的范围内。</p>
</blockquote>
<p>Python标准库的<code>hashlib</code>模块提供了对哈希函数的封装，通过使用<code>md5</code>、<code>sha1</code>、<code>sha256</code>等类，我们可以轻松的生成“数字指纹”。举一个简单的例子，用户注册时我们希望在数据库中保存用户的密码，很显然我们不能将用户密码直接保存在数据库中，这样可能会导致用户隐私的泄露，所以在数据库中保存用户密码时，通常都会将密码的“指纹”保存起来，用户登录时通过哈希函数计算密码的“指纹”再进行匹配来判断用户登录是否成功。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算字符串&quot;123456&quot;的MD5摘要</span></span><br><span class="line"><span class="built_in">print</span>(hashlib.md5(<span class="string">&#x27;123456&#x27;</span>.encode()).hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算文件&quot;Python-3.7.1.tar.xz&quot;的MD5摘要</span></span><br><span class="line">hasher = hashlib.md5()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;Python-3.7.1.tar.xz&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    data = file.read(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">while</span> data:</span><br><span class="line">        hasher.update(data)</span><br><span class="line">        data = file.read(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(hasher.hexdigest())</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明</strong>：很多网站在下载链接的旁边都提供了哈希摘要，完成文件下载后，我们可以计算该文件的哈希摘要并检查它与网站上提供的哈希摘要是否一致（指纹比对）。如果计算出的哈希摘要与网站提供的并不一致，很有可能是下载出错或该文件在传输过程中已经被篡改，这时候就不应该直接使用这个文件。</p>
</blockquote>
<h3 id="heapq-堆排序模块"><a href="#heapq-堆排序模块" class="headerlink" title="heapq - 堆排序模块"></a>heapq - 堆排序模块</h3><p><code>heapq</code>模块实现了堆排序算法，如果希望使用堆排序，尤其是要解决<strong>TopK问题</strong>（从序列中找到K个最大或最小元素），直接使用该模块即可，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">list1 = [<span class="number">34</span>, <span class="number">25</span>, <span class="number">12</span>, <span class="number">99</span>, <span class="number">87</span>, <span class="number">63</span>, <span class="number">58</span>, <span class="number">78</span>, <span class="number">88</span>, <span class="number">92</span>]</span><br><span class="line"><span class="comment"># 找出列表中最大的三个元素</span></span><br><span class="line"><span class="built_in">print</span>(heapq.nlargest(<span class="number">3</span>, list1))</span><br><span class="line"><span class="comment"># 找出列表中最小的三个元素</span></span><br><span class="line"><span class="built_in">print</span>(heapq.nsmallest(<span class="number">3</span>, list1))</span><br><span class="line"></span><br><span class="line">list2 = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;IBM&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">91.1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;AAPL&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">50</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">543.22</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;FB&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">21.09</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;HPQ&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">35</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">31.75</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;YHOO&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">45</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">16.35</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;ACME&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">115.65</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 找出价格最高的三只股票</span></span><br><span class="line"><span class="built_in">print</span>(heapq.nlargest(<span class="number">3</span>, list2, key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;price&#x27;</span>]))</span><br><span class="line"><span class="comment"># 找出持有数量最高的三只股票</span></span><br><span class="line"><span class="built_in">print</span>(heapq.nlargest(<span class="number">3</span>, list2, key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;shares&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<h3 id="itertools-迭代工具模块"><a href="#itertools-迭代工具模块" class="headerlink" title="itertools - 迭代工具模块"></a>itertools - 迭代工具模块</h3><p><code>itertools</code>可以帮助我们生成各种各样的迭代器，大家可以看看下面的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生ABCD的全排列</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> itertools.permutations(<span class="string">&#x27;ABCD&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生ABCDE的五选三组合</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> itertools.combinations(<span class="string">&#x27;ABCDE&#x27;</span>, <span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生ABCD和123的笛卡尔积</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> itertools.product(<span class="string">&#x27;ABCD&#x27;</span>, <span class="string">&#x27;123&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生ABC的无限循环序列</span></span><br><span class="line">it = itertools.cycle((<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br></pre></td></tr></table></figure>

<h3 id="random-随机数和随机抽样模块"><a href="#random-随机数和随机抽样模块" class="headerlink" title="random - 随机数和随机抽样模块"></a>random - 随机数和随机抽样模块</h3><p>这个模块我们之前已经用过很多次了，生成随机数、实现随机乱序和随机抽样，下面是常用函数的列表。</p>
<ul>
<li><code>getrandbits(k)</code>：返回具有<code>k</code>个随机比特位的整数。</li>
<li><code>randrange(start, stop[, step])</code>：从<code>range(start, stop, step)</code> 返回一个随机选择的元素，但实际上并没有构建一个<code>range</code>对象。</li>
<li><code>randint(a, b)</code>：返回随机整数<code>N</code>满足<code>a &lt;= N &lt;= b</code>，相当于<code>randrange(a, b+1)</code>。</li>
<li><code>choice(seq)</code>：从非空序列<code>seq</code>返回一个随机元素。 如果<code>seq</code>为空，则引发<code>IndexError</code>。</li>
<li><code>choices(population, weight=None, *, cum_weights=None, k=1)</code>：从<code>population</code>中选择替换，返回大小为<code>k</code>的元素列表。 如果<code>population</code>为空，则引发<code>IndexError</code>。</li>
<li><code>shuffle(x[, random])</code>：将序列<code>x</code>随机打乱位置。</li>
<li><code>sample(population, k)</code>：返回从总体序列或集合中选择<code>k</code>个不重复元素构造的列表，用于无重复的随机抽样。</li>
<li><code>random()</code>：返回<code>[0.0, 1.0)</code>范围内的下一个随机浮点数。</li>
<li><code>expovariate(lambd)</code>：指数分布。</li>
<li><code>gammavariate(alpha, beta)</code>：伽玛分布。</li>
<li><code>gauss(mu, sigma)</code> / <code>normalvariate(mu, sigma)</code>：正态分布。</li>
<li><code>paretovariate(alpha)</code>：帕累托分布。 </li>
<li><code>weibullvariate(alpha, beta)</code>：威布尔分布。</li>
</ul>
<h3 id="os-path-路径操作相关模块"><a href="#os-path-路径操作相关模块" class="headerlink" title="os.path - 路径操作相关模块"></a>os.path - 路径操作相关模块</h3><p><code>os.path</code>模块封装了操作路径的工具函数，如果程序中需要对文件路径做拼接、拆分、获取以及获取文件的存在性和其他属性，这个模块将会非常有帮助，下面为大家罗列一些常用的函数。</p>
<ul>
<li><code>dirname(path)</code>：返回路径<code>path</code>的目录名称。</li>
<li><code>exists(path)</code>：如果<code>path</code>指向一个已存在的路径或已打开的文件描述符，返回 <code>True</code>。</li>
<li><code>getatime(path)</code> / <code>getmtime(path)</code> / <code>getctime(path)</code>：返回<code>path</code>的最后访问时间/最后修改时间/创建时间。</li>
<li><code>getsize(path)</code>：返回<code>path</code>的大小，以字节为单位。如果该文件不存在或不可访问，则抛出<code>OSError</code>异常。</li>
<li><code>isfile(path)</code>：如果<code>path</code>是普通文件，则返回 <code>True</code>。</li>
<li><code>isdir(path)</code>：如果<code>path</code>是目录（文件夹），则返回<code>True</code>。</li>
<li><code>join(path, *paths)</code>：合理地拼接一个或多个路径部分。返回值是<code>path</code>和<code>paths</code>所有值的连接，每个非空部分后面都紧跟一个目录分隔符 (<code>os.sep</code>)，除了最后一部分。这意味着如果最后一部分为空，则结果将以分隔符结尾。如果参数中某个部分是绝对路径，则绝对路径前的路径都将被丢弃，并从绝对路径部分开始连接。</li>
<li><code>splitext(path)</code>：将路径<code>path</code>拆分为一对，即<code>(root, ext)</code>，使得<code>root + ext == path</code>，其中<code>ext</code>为空或以英文句点开头，且最多包含一个句点。</li>
</ul>
<h3 id="uuid-UUID生成模块"><a href="#uuid-UUID生成模块" class="headerlink" title="uuid - UUID生成模块"></a>uuid - UUID生成模块</h3><p><code>uuid</code>模块可以帮助我们生成全局唯一标识符（Universal Unique IDentity）。该模块提供了四个用于生成UUID的函数，分别是：</p>
<ul>
<li><code>uuid1()</code>：由MAC地址、当前时间戳、随机数生成，可以保证全球范围内的唯一性。</li>
<li><code>uuid3(namespace, name)</code>：通过计算命名空间和名字的MD5哈希摘要（“指纹”）值得到，保证了同一命名空间中不同名字的唯一性，和不同命名空间的唯一性，但同一命名空间的同一名字会生成相同的UUID。</li>
<li><code>uuid4()</code>：由伪随机数生成UUID，有一定的重复概率，该概率可以计算出来。</li>
<li><code>uuid5()</code>：算法与<code>uuid3</code>相同，只不过哈希函数用SHA-1取代了MD5。</li>
</ul>
<p>由于<code>uuid4</code>存在概率型重复，那么在真正需要全局唯一标识符的地方最好不用使用它。在分布式环境下，<code>uuid1</code>是很好的选择，因为它能够保证生成ID的全局唯一性。下面是在<strong>Python交互式环境中</strong>使用<code>uuid1</code>函数生成全局唯一标识符的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> uuid</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uuid.uuid1().<span class="built_in">hex</span></span><br><span class="line"><span class="string">&#x27;622a8334baab11eaaa9c60f81da8d840&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uuid.uuid1().<span class="built_in">hex</span></span><br><span class="line"><span class="string">&#x27;62b066debaab11eaaa9c60f81da8d840&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uuid.uuid1().<span class="built_in">hex</span></span><br><span class="line"><span class="string">&#x27;642c0db0baab11eaaa9c60f81da8d840&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="简单的总结"><a href="#简单的总结" class="headerlink" title="简单的总结"></a>简单的总结</h3><p>Python标准库中有大量的模块，日常开发中有很多常见的任务在Python标准库中都有封装好的函数或类可供使用，这也是Python这门语言最可爱的地方。</p>

        


        <span>
          <a class="article-read" href="/2021/09/12/第20课：Python标准库初探/"> Read more -->
          </span>
        </div>

        
      </div>
      


      <div id="recent-posts-paginator">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"> </a>
      </div>

    </div>

<aside id="sidebar">
  
  <div class="widget-box">
  	  <div class="widget-box">
    <h3 class="widget-title-friends">friends</h3>
    <div class="widget">
      
        <a class="friends-list-link" style="display: block;" href="https://fireworks99.github.io/" title target='_blank'
        >fireworks99</a>
      
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	

  </div>
  
  <div class="widget-box">
  	

  </div>
  
  <div class="widget-box">
  	
  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-archive">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>

  </div>
  
  <div class="widget-box">
  	
  <div class="widget-box">
    <h3 class="widget-title-post">recent_posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="recent_posts-list-link" href="/2021/09/12/%E7%AC%AC30%E8%AF%BE%EF%BC%9A%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8/">(no title)</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2021/09/12/%E7%AC%AC29%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E5%92%8C%E7%9F%AD%E4%BF%A1/">(no title)</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2021/09/12/%E7%AC%AC28%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F/">(no title)</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2021/09/12/%E7%AC%AC27%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E6%93%8D%E4%BD%9CPDF%E6%96%87%E4%BB%B6/">(no title)</a>
          </li>
        
          <li>
            <a class="recent_posts-list-link" href="/2021/09/12/%E7%AC%AC26%E8%AF%BE%EF%BC%9A%E7%94%A8Python%E6%93%8D%E4%BD%9CWord%E6%96%87%E4%BB%B6%E5%92%8CPowerPoint/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  </div>
  
</aside>

<!-- <div id="paginator"> -->
<!--   <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"> </a> -->
<!-- </div> -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            processEscapes: true
          }
        });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
            tex2jax: {
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
          });
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
              var all = MathJax.Hub.getAllJax(), i;
              for(i=0; i < all.length; i += 1) {
                  all[i].SourceElement().parentNode.className += ' has-jax';
              }
          });
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



			</div>
		</div>

		<div id="bottom-outer">
			<div id="bottom-inner">
				Site by 田裕平 | 
				Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a> |
				theme <a target="_blank" rel="noopener" href="https://github.com/fireworks99/hexo-theme-PreciousJoy">PreciousJoy</a>
			</div>
		</div>

		
	</div>





	
	<!-- scripts list from theme config.yml -->
	
	<script src="/js/jquery-3.5.1.min.js"></script>
	
	<script src="/js/PreciousJoy.js"></script>
	
	<script src="/js/highlight.pack.js"></script>
	
	<script src="/js/jquery.fancybox.min.js"></script>
	
	<script src="/js/search.js"></script>
	
	<script src="/js/load.js"></script>
	
	

	<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
